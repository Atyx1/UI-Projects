
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book Discovery Platform</title>
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind with our custom settings -->
    <script>
      tailwind.config = {
        theme: {
          screens: {
            xs: "480px",
            sm: "640px",
            md: "768px",
            lg: "1024px",
            xl: "1280px",
            "2xl": "1536px",
          },
          extend: {
            colors: {
              navy: "#14172A",
              darknavy: "#1E2033",
              lightgray: "#B0B3C1",
            },
          },
        },
      };
    </script>
    <!-- Immediate theme check to prevent flash -->
    <script>
      // Check for theme preference immediately before any rendering
      document.addEventListener("DOMContentLoaded", function () {
        if (localStorage.getItem("darkMode") === "false") {
          document.documentElement.classList.add("light-mode");
          document.body.classList.add("light-mode");
        }
      });
    </script>
    <!-- Satoshi Font -->
    <link
      href="https://api.fontshare.com/v2/css?f[]=satoshi@400,500,700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Satoshi", sans-serif;
        background-color: #14172a;
        color: white;
        background-image: radial-gradient(
          circle at 50% 50%,
          #232545 0%,
          #14172a 100%
        );
        min-height: 100vh;
      }
      .primary-gradient {
        background: linear-gradient(to right, #4a3b7f, #ff4b82);
      }
      .secondary-gradient {
        background: linear-gradient(to right, #00ddeb, #ff4b82);
      }
      /* Genre-specific gradients */
      .genre-mystery {
        background: linear-gradient(to right, #3a506b, #5b8fb9);
      }
      .genre-romance {
        background: linear-gradient(to right, #ff416c, #ff4b82);
      }
      .genre-fantasy {
        background: linear-gradient(to right, #6c4bef, #c961de);
      }
      .genre-science-fiction {
        background: linear-gradient(to right, #0072ff, #00ddeb);
      }
      .genre-thriller {
        background: linear-gradient(to right, #ff4e50, #f9d423);
      }
      .genre-non-fiction {
        background: linear-gradient(to right, #11998e, #38ef7d);
      }
      .genre-self-help {
        background: linear-gradient(to right, #f37335, #fdc830);
      }
      .genre-drama {
        background: linear-gradient(to right, #8e2de2, #4a00e0);
      }
      /* Default gradient for any other genres */
      .genre-default {
        background: linear-gradient(to right, #4a3b7f, #ff4b82);
      }
      .neomorphic {
        box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3),
          -5px -5px 15px rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }
      .glassmorphic {
        background: rgba(30, 32, 51, 0.7);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .book-detail-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 50;
        overflow-y: auto;
      }
      .book-detail-modal.show {
        display: block;
      }
      .hover-scale {
        transition: transform 0.3s ease;
      }
      .hover-scale:hover {
        transform: scale(1.05);
      }

      /* Improved scrollbar styling */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: rgba(26, 29, 45, 0.8);
      }
      ::-webkit-scrollbar-thumb {
        background: linear-gradient(to bottom, #4a3b7f, #ff4b82);
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(to bottom, #00ddeb, #ff4b82);
      }

      /* Preloader */
      .preloader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #14172a;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
      }
      .preloader.hidden {
        opacity: 0;
        visibility: hidden;
      }
      .book-loader {
        position: relative;
        width: 80px;
        height: 120px;
        perspective: 1000px;
      }
      .book-page {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        transform-origin: left center;
        background: linear-gradient(to right, #4a3b7f, #ff4b82);
        animation: page-flip 1.5s infinite ease-in-out;
        border-radius: 0 5px 5px 0;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      }
      .book-page:nth-child(1) {
        animation-delay: 0s;
        z-index: 5;
      }
      .book-page:nth-child(2) {
        animation-delay: 0.3s;
        z-index: 4;
      }
      .book-page:nth-child(3) {
        animation-delay: 0.6s;
        z-index: 3;
      }
      .book-page:nth-child(4) {
        animation-delay: 0.9s;
        z-index: 2;
      }
      .book-page:nth-child(5) {
        animation-delay: 1.2s;
        z-index: 1;
      }
      @keyframes page-flip {
        0% {
          transform: rotateY(0deg);
        }
        40% {
          transform: rotateY(-180deg);
        }
        100% {
          transform: rotateY(-180deg);
        }
      }

      /* Mobile-specific styles */
      @media (max-width: 768px) {
        .mobile-bottom-nav {
          position: fixed;
          bottom: 0;
          left: 0;
          right: 0;
          display: flex;
          justify-content: space-around;
          align-items: center;
          padding: 0.75rem 0.5rem;
          background: rgba(20, 23, 42, 0.95);
          -webkit-backdrop-filter: blur(10px);
          backdrop-filter: blur(10px);
          border-top: 1px solid rgba(255, 255, 255, 0.1);
          z-index: 40;
          box-shadow: 0 -5px 10px rgba(0, 0, 0, 0.15);
        }

        .nav-item {
          display: flex;
          flex-direction: column;
          align-items: center;
          font-size: 0.75rem;
        }
        .md\:fixed-header {
          position: sticky;
          top: 0;
          z-index: 30;
          padding: 15px;
          background: rgba(20, 23, 42, 0.95);
          -webkit-backdrop-filter: blur(10px);
          backdrop-filter: blur(10px);
        }
      }

      /* Improved mobile header and search responsiveness */
      @media (max-width: 428px) {
        /* iPhone 12 Pro and smaller screens */
        .mobile-optimized-header {
          padding: 10px 8px !important;
          margin-bottom: 12px !important;
          flex-wrap: wrap !important;
          gap: 8px !important;
        }

        .mobile-logo-container {
          margin-right: 6px;
          flex-shrink: 0;
        }

        .mobile-logo-text {
          font-size: 1.1rem !important;
          white-space: nowrap;
        }

        .mobile-logo-icon {
          width: 2.25rem !important;
          height: 2.25rem !important;
          margin-right: 6px !important;
        }

        .mobile-search-bar {
          margin: 0 4px !important;
          width: 100% !important;
          order: 3 !important;
          margin-top: 6px !important;
        }

        .mobile-search-input {
          font-size: 0.875rem !important;
          padding: 0.375rem 0.75rem 0.375rem 2rem !important;
          height: 2.5rem !important;
        }

        .mobile-search-icon {
          left: 8px !important;
          top: 50% !important;
          transform: translateY(-50%) !important;
        }

        .mobile-right-controls {
          padding-left: 4px !important;
          margin-left: auto !important;
        }

        .mobile-theme-toggle {
          padding: 4px !important;
        }

        /* Mobil düzende Explore Books başlığı ve kontroller düzeni için */
        main .mb-6 {
          margin-bottom: 1rem !important;
        }

        main h2.text-2xl {
          font-size: 1.5rem !important;
          margin-bottom: 0.25rem !important;
        }

        /* Kontroller için düzenlemeler */
        .view-toggle {
          margin-right: 8px !important;
        }

        /* Mobil kontroller alanı için düzenlemeler */
        .controls-container {
          margin-top: 1rem !important;
          margin-bottom: 1rem !important;
          gap: 0.5rem !important;
          flex-wrap: wrap !important;
        }

        /* İkon hizalama düzeltmesi */
        .sort-controls {
          display: flex !important;
          align-items: center !important;
        }

        .sort-controls-wrapper {
          display: flex !important;
          align-items: center !important;
        }

        .sort-direction-button {
          margin-left: 8px !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          padding: 0.5rem !important;
          height: 40px !important;
          width: 40px !important;
        }

        /* View toggle butonları için düzenlemeler */
        .view-toggle button {
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          height: 40px !important;
          width: 40px !important;
        }
      }

      /* Even smaller screens additional adjustments */
      @media (max-width: 375px) {
        .mobile-optimized-header {
          padding: 8px 6px !important;
        }

        .mobile-logo-text {
          font-size: 1rem !important;
        }

        .mobile-logo-icon {
          width: 2rem !important;
          height: 2rem !important;
          margin-right: 4px !important;
        }

        .mobile-search-input {
          height: 2.25rem !important;
        }

        /* Daha küçük ekranlarda kontroller için ek düzenlemeler */
        .controls-container {
          flex-direction: column !important;
          align-items: flex-start !important;
          gap: 0.75rem !important;
        }

        .controls-container > div {
          margin-bottom: 8px !important;
          width: 100% !important;
        }

        .sort-controls-wrapper {
          width: 100% !important;
          justify-content: space-between !important;
        }

        .sort-controls {
          flex: 1 !important;
        }
      }

      /* Category Cards */
      .category-card {
        position: relative;
        height: 180px;
        box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.25),
          -5px -5px 15px rgba(255, 255, 255, 0.05);
        transition: all 0.3s ease;
        transform-style: preserve-3d;
        perspective: 1000px;
        cursor: pointer;
        overflow: hidden;
      }

      .category-card:hover {
        transform: translateY(-5px) scale(1.01) rotateX(2deg);
        box-shadow: 8px 8px 20px rgba(0, 0, 0, 0.3),
          -8px -8px 20px rgba(255, 255, 255, 0.07);
      }

      .category-card::before {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 30%;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
        z-index: 1;
      }

      .category-card .perspective {
        transform-style: preserve-3d;
        perspective: 1000px;
      }

      .category-card .category-image {
        transition: transform 0.3s ease-out;
      }

      .category-card:hover .category-image {
        transform: scale(1.08);
      }

      /* Genre-specific gradients */
      .gradient-fiction {
        background: linear-gradient(135deg, #3a7bd5, #00d2ff);
      }

      .gradient-nonfiction {
        background: linear-gradient(135deg, #ff5f6d, #ffc371);
      }

      .gradient-mystery {
        background: linear-gradient(135deg, #654ea3, #eaafc8);
      }

      .gradient-scifi {
        background: linear-gradient(135deg, #2c3e50, #4ca1af);
      }

      .gradient-fantasy {
        background: linear-gradient(135deg, #9d50bb, #6e48aa);
      }

      .gradient-romance {
        background: linear-gradient(135deg, #ff758c, #ff7eb3);
      }

      .gradient-horror {
        background: linear-gradient(135deg, #232526, #414345);
      }

      .gradient-thriller {
        background: linear-gradient(135deg, #8e0e00, #1f1c18);
      }

      .gradient-historical {
        background: linear-gradient(135deg, #a73737, #7a2828);
      }

      .gradient-biography {
        background: linear-gradient(135deg, #4b6cb7, #182848);
      }

      .gradient-poetry {
        background: linear-gradient(135deg, #2193b0, #6dd5ed);
      }

      .gradient-children {
        background: linear-gradient(135deg, #ee9ca7, #ffdde1);
      }

      .gradient-selfhelp {
        background: linear-gradient(135deg, #11998e, #38ef7d);
      }

      .gradient-business {
        background: linear-gradient(135deg, #396afc, #2948ff);
      }

      .gradient-default {
        background: linear-gradient(135deg, #304352, #485563);
      }

      /* Category background images for mobile */
      @media (max-width: 768px) {
        .category-card {
          position: relative;
          min-height: 180px;
          border-radius: 12px;
          overflow: hidden;
        }

        .category-card .category-image {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          object-fit: cover;
          z-index: 1;
          opacity: 0.7;
        }

        .category-card .category-overlay {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: linear-gradient(
            to bottom,
            rgba(0, 0, 0, 0.3),
            rgba(0, 0, 0, 0.8)
          );
          z-index: 2;
        }

        .category-card .content {
          position: relative;
          z-index: 3;
        }
      }

      /* Neomorphic styles */
      .neomorphic {
        border-radius: 16px;
        background: #14172a;
        box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3),
          -5px -5px 15px rgba(255, 255, 255, 0.04);
      }

      /* Light mode styles */
      body.light-mode {
        background-color: #f5f7fa;
        color: #333;
        background-image: radial-gradient(circle at 50% 50%, #ffffff, #f0f2f5);
      }

      body.light-mode .neomorphic {
        background: #f0f2f5;
        box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.1),
          -5px -5px 15px rgba(255, 255, 255, 0.8);
      }

      body.light-mode .text-lightgray {
        color: #667085;
      }

      body.light-mode .bg-gray-800 {
        background-color: #eaecf0;
      }

      body.light-mode .glassmorphic {
        background: rgba(240, 242, 245, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.5);
      }

      body.light-mode select,
      body.light-mode option {
        color: #333;
      }

      /* Fix desktop nav styles for light mode */
      body.light-mode .desktop-nav .nav-link {
        color: #667085;
      }

      body.light-mode .desktop-nav .nav-link:hover {
        color: #1e1e1e;
      }

      body.light-mode .desktop-nav .nav-link.active {
        color: #1e1e1e;
        font-weight: 600;
      }

      /* Light mode mobile navigation */
      body.light-mode .mobile-bottom-nav {
        background: rgba(245, 247, 250, 0.95);
        border-top: 1px solid rgba(0, 0, 0, 0.05);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
      }

      body.light-mode .mobile-bottom-nav .nav-item {
        color: #667085;
      }

      body.light-mode .mobile-bottom-nav .nav-item.active {
        background: linear-gradient(to right, #6c5ce7, #ff4b82);
        color: #ffffff;
      }

      /* Fix input field styles for light mode */
      body.light-mode input[type="text"] {
        background-color: rgba(234, 236, 240, 0.8);
        color: #333;
      }

      body.light-mode input[type="text"]::placeholder {
        color: #667085;
      }

      /* Make sort controls match theme */
      body.light-mode .sort-controls button,
      body.light-mode .view-toggle button {
        color: #333;
      }

      body.light-mode .view-toggle button.bg-gray-700 {
        background-color: #d1d5db;
        color: #1f2937;
      }

      body.light-mode .sort-controls .dropdown-menu {
        background-color: #eaecf0;
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      body.light-mode .sort-controls .dropdown-menu button {
        color: #333;
      }

      body.light-mode .sort-controls .dropdown-menu button:hover {
        background-color: #d1d5db;
      }

      body.light-mode .sort-controls .dropdown-menu button.active,
      body.light-mode .sort-controls .dropdown-menu button.bg-gray-700,
      body.light-mode .sort-controls .dropdown-menu button[class*="bg-gray"] {
        background-color: #d1d5db;
        color: #333;
        font-weight: 600;
      }

      /* Fix for selected option in dropdown */
      body.light-mode .dropdown-menu .bg-gray-700,
      body.light-mode .dropdown-menu .font-medium {
        background-color: #e2e8f0 !important;
        color: #333 !important;
      }

      /* Preloader light mode styles */
      body.light-mode .preloader {
        background-color: #f5f7fa;
      }

      body.light-mode .book-page {
        background: linear-gradient(to right, #6c5ce7, #ff4b82);
      }

      /* Modal styles */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.6);
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
        overflow-y: auto;
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
      }

      .modal-content {
        border-radius: 1rem;
        width: 100%;
        max-width: 900px;
        max-height: 90vh;
        overflow-y: auto;
        padding: 1.5rem;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        background: rgba(26, 30, 42, 0.85);
        -webkit-backdrop-filter: blur(15px);
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        /* Hide scrollbar but keep functionality */
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE and Edge */
      }

      .modal-content::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera */
      }

      body.light-mode .modal {
        background-color: rgba(245, 247, 250, 0.5);
      }

      body.light-mode .modal-content {
        background: rgba(240, 242, 245, 0.85);
        border: 1px solid rgba(255, 255, 255, 0.6);
      }

      body.light-mode #closeModalBtn:hover {
        background-color: rgba(0, 0, 0, 0.05);
      }

      /* Mobile drawer modal */
      @media (max-width: 768px) {
        .modal {
          align-items: flex-end;
          padding: 0;
        }

        .modal-content {
          border-radius: 2rem 2rem 0 0;
          max-height: 85vh;
          padding-top: 2.5rem;
          position: relative;
          transform: translateY(0);
          transition: transform 0.3s ease-out;
          width: 100%;
          margin: 0;
        }

        .modal.hidden .modal-content {
          transform: translateY(100%);
        }

        /* Add a purple gradient accent to the top edge */
        .modal-content::after {
          content: "";
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 8px;
          background: linear-gradient(to right, #6c5ce7, #ff4b82);
          border-radius: 2rem 2rem 0 0;
        }

        /* Drawer handle */
        .modal-content::before {
          content: "";
          position: absolute;
          top: 1rem;
          left: 50%;
          transform: translateX(-50%);
          width: 4.5rem;
          height: 0.3rem;
          background-color: rgba(255, 255, 255, 0.3);
          border-radius: 1rem;
          z-index: 5;
        }

        body.light-mode .modal-content::before {
          background-color: rgba(0, 0, 0, 0.2);
        }

        /* Add some extra padding at the bottom to account for mobile browsers */
        .modal-content {
          padding-bottom: 4rem;
        }

        /* Animation for drawer opening */
        .modal-content.drawer {
          animation: drawer-slide-up 0.3s ease-out forwards;
        }

        @keyframes drawer-slide-up {
          from {
            transform: translateY(100%);
          }
          to {
            transform: translateY(0);
          }
        }

        /* Mobile theme toggle in header */
        .mobile-theme-toggle {
          display: block;
          position: absolute;
          top: 1.25rem;
          right: 1.25rem;
        }
      }

      /* Improved scrollbar styling */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(26, 29, 45, 0.8);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb {
        background: linear-gradient(to bottom, #4a3b7f, #ff4b82);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(to bottom, #00ddeb, #ff4b82);
      }

      /* Light mode scrollbar */
      body.light-mode ::-webkit-scrollbar-track {
        background: rgba(240, 242, 245, 0.8);
      }

      body.light-mode ::-webkit-scrollbar-thumb {
        background: linear-gradient(to bottom, #6c5ce7, #ff4b82);
      }

      /* Desktop navigation styles */
      .desktop-nav {
        display: none;
      }

      @media (min-width: 769px) {
        .bottom-nav {
          display: none;
        }

        .desktop-nav {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1rem 2rem;
          background: rgba(20, 23, 42, 0.95);
          -webkit-backdrop-filter: blur(10px);
          backdrop-filter: blur(10px);
          position: sticky;
          top: 0;
          z-index: 40;
          position: relative;
          height: 64px; /* Fixed height to maintain consistency */
        }

        .desktop-nav .logo {
          font-size: 1.5rem;
          font-weight: bold;
          position: absolute;
          left: 2rem;
          top: 50%;
          transform: translateY(-50%);
        }

        .desktop-nav .nav-links {
          display: flex;
          gap: 2rem;
          margin: 0 auto;
          position: absolute;
          left: 50%;
          top: 50%;
          transform: translate(-50%, -50%);
        }

        .desktop-nav #desktopDarkModeToggle {
          position: absolute;
          right: 2rem;
          top: 50%;
          transform: translateY(-50%);
        }

        .desktop-nav .nav-link {
          position: relative;
          padding: 8px 0;
          color: #b0b3c1;
          transition: color 0.3s ease;
        }

        .desktop-nav .nav-link:hover {
          color: white;
        }

        .desktop-nav .nav-link.active {
          color: white;
        }

        .desktop-nav .nav-link.active::after {
          content: "";
          position: absolute;
          bottom: 0;
          left: 0;
          width: 100%;
          height: 2px;
          background: linear-gradient(to right, #4a3b7f, #ff4b82);
          border-radius: 2px;
        }

        body.light-mode .desktop-nav {
          background: #f0f2f5;
        }
      }

      /* Make desktop-nav sticky at top */
      @media (min-width: 769px) {
        .desktop-nav {
          position: sticky;
          top: 0;
          z-index: 50;
        }
      }

      /* Responsive layout adjustments */
      @media (max-width: 640px) {
        .categories-grid {
          grid-template-columns: repeat(1, 1fr);
        }

        .category-card {
          height: 150px;
        }
      }

      /* Theme Toggle */
      .theme-toggle-container {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin-left: 20px;
        position: relative;
      }

      .theme-toggle {
        position: relative;
        width: 50px;
        height: 24px;
        background-color: #555; /* Dark mode background */
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .theme-toggle::before {
        content: "";
        position: absolute;
        width: 18px;
        height: 18px;
        left: 3px;
        top: 3px;
        background-color: #f1f1f1;
        border-radius: 50%;
        transition: transform 0.3s ease, background-color 0.3s ease;
      }

      .theme-icon {
        font-size: 16px;
        transition: all 0.3s ease;
        z-index: 2;
      }

      .theme-icon.sun {
        color: #ff9800;
        opacity: 1;
        margin-right: 8px;
      }

      .theme-icon.moon {
        color: #bbdefb;
        opacity: 1;
        margin-left: 8px;
      }

      /* Light Mode Styles */
      body.light-mode .theme-toggle {
        background-color: #e0eafc; /* Light blue background for light mode */
      }

      body.light-mode .theme-toggle::before {
        transform: translateX(26px);
        background-color: #ffffff; /* White toggle in light mode */
      }

      body.light-mode .theme-icon.sun {
        opacity: 1;
        color: #ff9800;
      }

      body.light-mode .theme-icon.moon {
        opacity: 0.4;
        color: #90caf9;
      }

      /* Remove any dark-mode specific styles that might override light mode */
      body:not(.dark-mode) .theme-toggle {
        background-color: #e0eafc;
      }

      body:not(.dark-mode) .theme-toggle::before {
        background-color: #ffffff;
      }

      /* Dark Mode Styles */
      body.dark-mode .theme-toggle {
        background-color: #333;
      }

      body.dark-mode .theme-toggle::before {
        background-color: #777;
      }

      body.dark-mode .theme-icon.sun {
        opacity: 0.4;
        color: #ffb74d;
      }

      body.dark-mode .theme-icon.moon {
        opacity: 1;
        color: #bbdefb;
      }

      /* Custom dropdown styling */
      .sort-controls .dropdown-menu {
        min-width: 160px;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
      }

      .sort-controls .dropdown-menu.show {
        max-height: 200px;
      }

      /* Fix for hover effect on cards when clicking like button */
      .book-card:active,
      .book-list-item:active {
        transform: none !important;
      }

      .favorite-btn:active + .book-card .hover-scale,
      .favorite-btn:active + .book-list-item .hover-scale {
        transform: none !important;
      }

      /* Dropdown selected option styling */
      .dropdown-menu .selected-option {
        background-color: #2a2f42;
        font-weight: 600;
      }

      body.light-mode .dropdown-menu .selected-option {
        background-color: #e2e8f0 !important;
        color: #333 !important;
        border-left: 3px solid #6c5ce7;
        padding-left: calc(1rem - 3px) !important;
      }

      /* Animations and Transitions */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
          transform: translateY(0);
        }
        to {
          opacity: 0;
          transform: translateY(10px);
        }
      }

      @keyframes scaleIn {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      /* View mode transition */
      .book-grid-container {
        transition: all 0.4s ease-out;
      }

      .book-card,
      .book-list-item {
        animation: scaleIn 0.3s ease-out forwards;
        will-change: transform, opacity;
        cursor: pointer;
      }

      /* Dropdown animation */
      .sort-controls .dropdown-menu {
        min-width: 160px;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1),
          opacity 0.2s ease-out, transform 0.3s ease-out;
        opacity: 0;
        transform: translateY(-10px);
        pointer-events: none;
      }

      .sort-controls .dropdown-menu.show {
        max-height: 200px;
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto;
      }

      /* Theme toggle animation */
      #desktopDarkModeToggle svg {
        transition: opacity 0.3s ease, transform 0.5s ease;
      }

      #desktopDarkModeToggle.animating svg {
        opacity: 0;
        transform: rotate(90deg);
      }

      /* Search animation */
      .filtered-out {
        animation: fadeOut 0.3s ease-out forwards;
      }
      .filtered-in {
        animation: fadeIn 0.3s ease-out forwards;
      }

      /* Smooth typing cursor (blink effect) */
      @keyframes cursor-blink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0;
        }
      }

      input[type="text"] {
        caret-color: currentColor; /* Restore default caret */
      }

      /* Remove the custom cursor that was causing issues */
      .custom-cursor {
        display: none;
      }

      /* Sort direction animation */
      .sort-direction-button svg {
        transition: transform 0.3s ease;
      }

      .sort-direction-button.asc svg {
        transform: rotate(180deg);
      }

      /* Smooth page transitions */
      .container {
        opacity: 0;
        animation: fadeIn 0.4s ease-out forwards;
      }

      /* Mobile bottom nav animations */
      .mobile-bottom-nav .nav-item {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* Custom pointer styling for clickable cards */
      .book-card,
      .book-list-item,
      .category-card {
        cursor: pointer;
      }

      /* Book card hover effects */
      .book-card img,
      .book-list-item img {
        transition: transform 0.3s ease-out;
      }

      .book-card:hover img,
      .book-list-item:hover img {
        transform: scale(1.08);
      }

      /* Category card hover effect */
      .category-card {
        overflow: hidden;
      }

      .category-card .category-image {
        transition: transform 0.3s ease-out;
      }

      .category-card:hover .category-image {
        transform: scale(1.08);
      }
    </style>
  </head>
  <body class="min-h-screen text-white">
    <!-- Preloader -->
    <div class="preloader" id="preloader">
      <div class="book-loader">
        <div class="book-page"></div>
        <div class="book-page"></div>
        <div class="book-page"></div>
        <div class="book-page"></div>
        <div class="book-page"></div>
      </div>
    </div>

    <div id="app" class="container mx-auto px-4 py-6 max-w-7xl">
      <!-- App content will be rendered here -->
    </div>

    <!-- Book Details Modal -->
    <div
      id="bookDetailsModal"
      class="modal hidden fixed inset-0 z-50 overflow-auto bg-black bg-opacity-50 flex items-center justify-center"
      style="display: none"
    >
      <div
        class="modal-content glassmorphic w-full max-w-4xl mx-4 md:mx-auto rounded-xl p-6 max-h-[90vh] overflow-y-auto"
      >
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold">Book Details</h2>
          <button
            id="closeModalBtn"
            class="p-2 rounded-full hover:bg-gray-700"
            title="Close details"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>
        <div id="bookDetailsContent">
          <!-- Book details will be inserted here -->
        </div>
      </div>
    </div>

    <!-- Main Script -->
    <script>
      // Variable to track if the modal should be allowed to open
      let allowModalOpen = false;

      // After a delay, allow the modal to be opened by user interaction
      setTimeout(() => {
        allowModalOpen = true;
      }, 1500);

      // Helper functions for filtering, sorting, and view management

      /**
       * Filter books based on filter criteria
       * @param {Array} books - Array of book objects
       * @param {Object} filters - Filter criteria {genre, author, year}
       * @returns {Array} - Filtered books
       */
      function filterBooks(books, filters) {
        return books.filter((book) => {
          // Check if book matches all provided filters
          if (
            filters.genre &&
            filters.genre !== "All" &&
            book.genre !== filters.genre
          ) {
            return false;
          }

          if (
            filters.author &&
            !book.author.toLowerCase().includes(filters.author.toLowerCase())
          ) {
            return false;
          }

          if (filters.year && book.year !== parseInt(filters.year)) {
            return false;
          }

          return true;
        });
      }

      /**
       * Sort books based on sort criteria
       * @param {Array} books - Array of book objects
       * @param {String} sortBy - Sort criteria ('popularity' or 'rating')
       * @returns {Array} - Sorted books
       */
      function sortBooks(books, sortBy) {
        const sortedBooks = [...books];

        if (sortBy === "popularity") {
          sortedBooks.sort((a, b) => b.popularity - a.popularity);
        } else if (sortBy === "rating") {
          sortedBooks.sort((a, b) => b.rating - a.rating);
        }

        return sortedBooks;
      }

      /**
       * Get unique genres from books array
       * @param {Array} books - Array of book objects
       * @returns {Array} - Array of unique genres
       */
      function getUniqueGenres(books) {
        const genres = books.map((book) => book.genre);
        return ["All", ...new Set(genres)];
      }

      /**
       * Get unique years from books array
       * @param {Array} books - Array of book objects
       * @returns {Array} - Array of unique years
       */
      function getUniqueYears(books) {
        const years = books.map((book) => book.year);
        return ["All", ...new Set(years)];
      }

      /**
       * Format rating for display
       * @param {Number} rating - Book rating
       * @returns {String} - Formatted rating
       */
      function formatRating(rating) {
        return rating.toFixed(1);
      }

      /**
       * Generate stars based on rating
       * @param {Number} rating - Book rating
       * @returns {String} - HTML for star display
       */
      function generateStars(rating) {
        const fullStars = Math.floor(rating);
        const halfStar = rating % 1 >= 0.5;
        const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);

        let starsHTML = "";

        // Full stars
        for (let i = 0; i < fullStars; i++) {
          starsHTML +=
            '<svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>';
        }

        // Half star
        if (halfStar) {
          starsHTML +=
            '<svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" clip-path="inset(0 50% 0 0)"></path></svg>';
        }

        // Empty stars
        for (let i = 0; i < emptyStars; i++) {
          starsHTML +=
            '<svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>';
        }

        return starsHTML;
      }

      /**
       * SearchBar component
       * @param {Function} onSearch - Callback function when search is performed
       * @returns {HTMLElement} - Search bar component
       */
      function SearchBar(onSearch) {
        // Create the search bar container
        const searchBarContainer = document.createElement("div");
        searchBarContainer.className = "w-full mb-6 md:fixed-header";

        // Create header flex container for logo and search
        const headerFlex = document.createElement("div");
        headerFlex.className =
          "flex flex-col md:flex-row md:items-center md:justify-between gap-4";

        // Create the logo container
        const logoContainer = document.createElement("div");
        logoContainer.className = "flex items-center mobile-logo-container";

        const logoIcon = document.createElement("div");
        logoIcon.className =
          "mr-3 primary-gradient w-12 h-12 rounded-xl neomorphic flex items-center justify-center mobile-logo-icon";
        logoIcon.innerHTML = `
        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"></path>
        </svg>
    `;

        const logoText = document.createElement("h1");
        logoText.className = "text-2xl md:text-3xl font-bold mobile-logo-text";
        logoText.textContent = "BookDiscover";

        logoContainer.appendChild(logoIcon);
        logoContainer.appendChild(logoText);

        // Create the search bar form
        const searchForm = document.createElement("form");
        searchForm.className =
          "relative flex w-full md:max-w-sm mobile-search-bar";
        searchForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const searchInput = searchForm.querySelector("input");
          if (searchInput) {
            onSearch(searchInput.value);
          }
        });

        // Create the search icon
        const searchIcon = document.createElement("div");
        searchIcon.className =
          "absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none mobile-search-icon";
        searchIcon.innerHTML = `
        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
    `;

        // Create the search input
        const searchInput = document.createElement("input");
        searchInput.type = "search";
        searchInput.className =
          "glassmorphic neomorphic py-2 pl-10 pr-4 block w-full rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mobile-search-input";
        searchInput.placeholder = "Search books, authors or genres";
        searchInput.setAttribute("aria-label", "Search books");

        // Create clear button
        const clearButton = document.createElement("button");
        clearButton.type = "button";
        clearButton.className =
          "absolute inset-y-0 right-0 flex items-center pr-3 cursor-pointer text-gray-400 hover:text-white transition-colors duration-200 hidden";
        clearButton.setAttribute("id", "clear-search");
        clearButton.innerHTML = `
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
    `;

        clearButton.addEventListener("click", () => {
          searchInput.value = "";
          clearButton.classList.add("hidden");
          onSearch("");
          searchInput.focus();
        });

        // Show/hide clear button based on input
        searchInput.addEventListener("input", () => {
          if (searchInput.value) {
            clearButton.classList.remove("hidden");
          } else {
            clearButton.classList.add("hidden");
          }
        });

        // Assemble the search bar
        searchForm.appendChild(searchIcon);
        searchForm.appendChild(searchInput);
        searchForm.appendChild(clearButton);

        // Assemble the header
        headerFlex.appendChild(logoContainer);
        headerFlex.appendChild(searchForm);

        searchBarContainer.appendChild(headerFlex);

        return searchBarContainer;
      }

      /**
       * FilterBar component
       * @param {Array} genres - Array of genres
       * @param {Array} years - Array of years
       * @param {Object} currentFilters - Current filter values
       * @param {Function} onFilterChange - Callback when filters change
       * @returns {HTMLElement} - Filter bar component
       */
      function FilterBar(genres, years, currentFilters, onFilterChange) {
        // Create filter bar container
        const filterBarContainer = document.createElement("div");
        filterBarContainer.className =
          "glassmorphic neomorphic rounded-lg p-4 sm:p-6 mb-6 relative";

        // Create mobile filter button container
        const mobileFilterContainer = document.createElement("div");
        mobileFilterContainer.className =
          "sm:hidden flex justify-between items-center";

        // Create filter button for mobile view
        const filterButton = document.createElement("button");
        filterButton.className =
          "flex items-center gap-2 py-2 px-4 secondary-gradient rounded-lg neomorphic";
        filterButton.innerHTML = `
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
        </svg>
        <span>Filters</span>
    `;

        // Create mobile filter count badge
        const activeFilterCount = getActiveFilterCount(currentFilters);
        const filterCountBadge = document.createElement("span");
        filterCountBadge.className =
          activeFilterCount > 0
            ? "ml-2 bg-white bg-opacity-20 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold"
            : "hidden";
        filterCountBadge.textContent = activeFilterCount;
        filterButton.appendChild(filterCountBadge);

        // Mobile applied filters summary
        const appliedFiltersSummary = document.createElement("div");
        appliedFiltersSummary.className = "text-sm text-lightgray truncate";
        appliedFiltersSummary.textContent =
          getAppliedFiltersSummary(currentFilters);

        mobileFilterContainer.appendChild(filterButton);
        mobileFilterContainer.appendChild(appliedFiltersSummary);

        // Create bottom sheet container for mobile filters
        const bottomSheet = document.createElement("div");
        bottomSheet.className =
          "fixed inset-0 bg-black bg-opacity-50 z-50 sm:hidden hidden";
        bottomSheet.id = "mobile-filter-sheet";

        // Create bottom sheet content
        const bottomSheetContent = document.createElement("div");
        bottomSheetContent.className =
          "absolute bottom-0 left-0 right-0 glassmorphic neomorphic rounded-t-xl p-6 transform transition-transform duration-300 translate-y-full";
        bottomSheetContent.id = "mobile-filter-content";

        // Create bottom sheet header
        const sheetHeader = document.createElement("div");
        sheetHeader.className = "flex items-center justify-between mb-6";

        const sheetTitle = document.createElement("h3");
        sheetTitle.className = "text-xl font-bold";
        sheetTitle.textContent = "Filter Books";

        const closeButton = document.createElement("button");
        closeButton.className =
          "p-2 rounded-full hover:bg-white hover:bg-opacity-10";
        closeButton.innerHTML = `
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
    `;

        sheetHeader.appendChild(sheetTitle);
        sheetHeader.appendChild(closeButton);

        // Create mobile filter form
        const mobileFilterForm = document.createElement("div");
        mobileFilterForm.className = "flex flex-col gap-6";

        // Create genre filter
        const mobileGenreContainer = createMobileFilterGroup(
          "Genre",
          "genre-filter-mobile",
          genres,
          currentFilters.genre
        );

        // Create year filter
        const mobileYearContainer = createMobileFilterGroup(
          "Year",
          "year-filter-mobile",
          years,
          currentFilters.year
        );

        // Create author filter
        const mobileAuthorContainer = document.createElement("div");
        mobileAuthorContainer.className = "mb-4";

        const mobileAuthorLabel = document.createElement("label");
        mobileAuthorLabel.className =
          "block text-sm uppercase tracking-wide font-medium text-lightgray mb-2";
        mobileAuthorLabel.textContent = "Author";
        mobileAuthorLabel.setAttribute("for", "author-filter-mobile");

        const mobileAuthorInput = document.createElement("input");
        mobileAuthorInput.type = "text";
        mobileAuthorInput.className =
          "block w-full py-3 px-4 bg-darknavy border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500";
        mobileAuthorInput.id = "author-filter-mobile";
        mobileAuthorInput.placeholder = "Enter author name";
        mobileAuthorInput.value = currentFilters.author || "";

        mobileAuthorContainer.appendChild(mobileAuthorLabel);
        mobileAuthorContainer.appendChild(mobileAuthorInput);

        // Create button container
        const buttonContainer = document.createElement("div");
        buttonContainer.className = "flex gap-4 mt-6";

        // Create apply button
        const applyButton = document.createElement("button");
        applyButton.className =
          "w-full py-3 px-6 secondary-gradient rounded-lg neomorphic hover:opacity-90 font-medium";
        applyButton.textContent = "Apply Filters";

        // Create reset button
        const resetButton = document.createElement("button");
        resetButton.className =
          "w-full py-3 px-6 glassmorphic rounded-lg neomorphic hover:opacity-90 font-medium";
        resetButton.textContent = "Reset";

        buttonContainer.appendChild(resetButton);
        buttonContainer.appendChild(applyButton);

        // Assemble mobile filter form
        mobileFilterForm.appendChild(mobileGenreContainer);
        mobileFilterForm.appendChild(mobileYearContainer);
        mobileFilterForm.appendChild(mobileAuthorContainer);
        mobileFilterForm.appendChild(buttonContainer);

        // Assemble bottom sheet
        bottomSheetContent.appendChild(sheetHeader);
        bottomSheetContent.appendChild(mobileFilterForm);

        bottomSheet.appendChild(bottomSheetContent);

        // Create filter layout container for desktop
        const desktopFilterLayout = document.createElement("div");
        desktopFilterLayout.className =
          "hidden sm:flex flex-row items-center gap-4";

        // Create genre filter for desktop
        const genreContainer = document.createElement("div");
        genreContainer.className = "flex-1";

        const genreLabel = document.createElement("label");
        genreLabel.className =
          "block text-xs uppercase tracking-wide font-medium text-lightgray mb-2";
        genreLabel.textContent = "Genre";
        genreLabel.setAttribute("for", "genre-filter");

        const genreSelectContainer = document.createElement("div");
        genreSelectContainer.className = "relative";

        const genreSelect = document.createElement("select");
        genreSelect.className =
          "block w-full py-2 px-3 bg-darknavy border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none";
        genreSelect.id = "genre-filter";

        // Add dropdown arrow
        const selectArrow = document.createElement("div");
        selectArrow.className =
          "absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none";
        selectArrow.innerHTML = `
        <svg class="w-4 h-4 text-lightgray" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
    `;

        // Add genre options
        genres.forEach((genre) => {
          const option = document.createElement("option");
          option.value = genre;
          option.textContent = genre;
          if (currentFilters.genre === genre) {
            option.selected = true;
          }
          genreSelect.appendChild(option);
        });

        genreSelect.addEventListener("change", (e) => {
          onFilterChange({ ...currentFilters, genre: e.target.value });
        });

        genreSelectContainer.appendChild(genreSelect);
        genreSelectContainer.appendChild(selectArrow);

        genreContainer.appendChild(genreLabel);
        genreContainer.appendChild(genreSelectContainer);

        // Create author filter for desktop
        const authorContainer = document.createElement("div");
        authorContainer.className = "flex-1";

        const authorLabel = document.createElement("label");
        authorLabel.className =
          "block text-xs uppercase tracking-wide font-medium text-lightgray mb-2";
        authorLabel.textContent = "Author";
        authorLabel.setAttribute("for", "author-filter");

        const authorInputContainer = document.createElement("div");
        authorInputContainer.className = "relative";

        const authorInput = document.createElement("input");
        authorInput.type = "text";
        authorInput.className =
          "block w-full py-2 px-3 bg-darknavy border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500";
        authorInput.id = "author-filter";
        authorInput.placeholder = "Enter author name";
        authorInput.value = currentFilters.author || "";

        // Add author search icon
        const authorIcon = document.createElement("div");
        authorIcon.className =
          "absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none";
        authorIcon.innerHTML = `
        <svg class="w-4 h-4 text-lightgray" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
    `;

        authorInput.addEventListener("input", (e) => {
          onFilterChange({ ...currentFilters, author: e.target.value });
        });

        authorInputContainer.appendChild(authorInput);
        authorInputContainer.appendChild(authorIcon);

        authorContainer.appendChild(authorLabel);
        authorContainer.appendChild(authorInputContainer);

        // Create year filter for desktop
        const yearContainer = document.createElement("div");
        yearContainer.className = "flex-1";

        const yearLabel = document.createElement("label");
        yearLabel.className =
          "block text-xs uppercase tracking-wide font-medium text-lightgray mb-2";
        yearLabel.textContent = "Year";
        yearLabel.setAttribute("for", "year-filter");

        const yearSelectContainer = document.createElement("div");
        yearSelectContainer.className = "relative";

        const yearSelect = document.createElement("select");
        yearSelect.className =
          "block w-full py-2 px-3 bg-darknavy border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none";
        yearSelect.id = "year-filter";

        // Add dropdown arrow
        const yearSelectArrow = document.createElement("div");
        yearSelectArrow.className =
          "absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none";
        yearSelectArrow.innerHTML = `
        <svg class="w-4 h-4 text-lightgray" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
    `;

        // Add year options
        years.forEach((year) => {
          const option = document.createElement("option");
          option.value = year;
          option.textContent = year;
          if (currentFilters.year === year) {
            option.selected = true;
          }
          yearSelect.appendChild(option);
        });

        yearSelect.addEventListener("change", (e) => {
          onFilterChange({ ...currentFilters, year: e.target.value });
        });

        yearSelectContainer.appendChild(yearSelect);
        yearSelectContainer.appendChild(yearSelectArrow);

        yearContainer.appendChild(yearLabel);
        yearContainer.appendChild(yearSelectContainer);

        // Create clear filters button for desktop
        const clearContainer = document.createElement("div");
        clearContainer.className = "flex items-end";

        const clearButton = document.createElement("button");
        clearButton.className =
          "py-2 px-4 text-sm text-lightgray hover:text-white transition-colors duration-200";
        clearButton.textContent = "Clear filters";
        clearButton.addEventListener("click", () => {
          onFilterChange({
            genre: "All",
            author: "",
            year: "All",
          });
        });

        clearContainer.appendChild(clearButton);

        // Assemble desktop filter layout
        desktopFilterLayout.appendChild(genreContainer);
        desktopFilterLayout.appendChild(authorContainer);
        desktopFilterLayout.appendChild(yearContainer);
        desktopFilterLayout.appendChild(clearContainer);

        // Mobile filter button event handler
        filterButton.addEventListener("click", () => {
          document
            .getElementById("mobile-filter-sheet")
            .classList.remove("hidden");
          setTimeout(() => {
            document
              .getElementById("mobile-filter-content")
              .classList.remove("translate-y-full");
          }, 10);

          // Update mobile filter values to match current filters
          const mobileGenreSelect = document.getElementById(
            "genre-filter-mobile"
          );
          if (mobileGenreSelect) {
            mobileGenreSelect.value = currentFilters.genre;
          }

          const mobileYearSelect =
            document.getElementById("year-filter-mobile");
          if (mobileYearSelect) {
            mobileYearSelect.value = currentFilters.year;
          }

          const mobileAuthorInput = document.getElementById(
            "author-filter-mobile"
          );
          if (mobileAuthorInput) {
            mobileAuthorInput.value = currentFilters.author || "";
          }
        });

        // Close button event handler
        closeButton.addEventListener("click", () => {
          document
            .getElementById("mobile-filter-content")
            .classList.add("translate-y-full");
          setTimeout(() => {
            document
              .getElementById("mobile-filter-sheet")
              .classList.add("hidden");
          }, 300);
        });

        // Handle backdrop click to close
        bottomSheet.addEventListener("click", (e) => {
          if (e.target === bottomSheet) {
            document
              .getElementById("mobile-filter-content")
              .classList.add("translate-y-full");
            setTimeout(() => {
              document
                .getElementById("mobile-filter-sheet")
                .classList.add("hidden");
            }, 300);
          }
        });

        // Apply button event handler
        applyButton.addEventListener("click", () => {
          const mobileGenreSelect = document.getElementById(
            "genre-filter-mobile"
          );
          const mobileYearSelect =
            document.getElementById("year-filter-mobile");
          const mobileAuthorInput = document.getElementById(
            "author-filter-mobile"
          );

          const newFilters = {
            genre: mobileGenreSelect
              ? mobileGenreSelect.value
              : currentFilters.genre,
            year: mobileYearSelect
              ? mobileYearSelect.value
              : currentFilters.year,
            author: mobileAuthorInput
              ? mobileAuthorInput.value
              : currentFilters.author,
          };

          onFilterChange(newFilters);

          // Close the sheet
          document
            .getElementById("mobile-filter-content")
            .classList.add("translate-y-full");
          setTimeout(() => {
            document
              .getElementById("mobile-filter-sheet")
              .classList.add("hidden");
          }, 300);
        });

        // Reset button event handler
        resetButton.addEventListener("click", () => {
          if (document.getElementById("genre-filter-mobile")) {
            document.getElementById("genre-filter-mobile").value = "All";
          }

          if (document.getElementById("year-filter-mobile")) {
            document.getElementById("year-filter-mobile").value = "All";
          }

          if (document.getElementById("author-filter-mobile")) {
            document.getElementById("author-filter-mobile").value = "";
          }
        });

        // Assemble filter bar
        filterBarContainer.appendChild(mobileFilterContainer);
        filterBarContainer.appendChild(desktopFilterLayout);

        // Append the bottom sheet to the body
        document.body.appendChild(bottomSheet);

        return filterBarContainer;
      }

      /**
       * Create a mobile filter select group
       */
      function createMobileFilterGroup(labelText, id, options, currentValue) {
        const container = document.createElement("div");
        container.className = "mb-4";

        const label = document.createElement("label");
        label.className =
          "block text-sm uppercase tracking-wide font-medium text-lightgray mb-2";
        label.textContent = labelText;
        label.setAttribute("for", id);

        const selectContainer = document.createElement("div");
        selectContainer.className = "relative";

        const select = document.createElement("select");
        select.className =
          "block w-full py-3 px-4 bg-darknavy border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none";
        select.id = id;

        // Add dropdown arrow
        const arrow = document.createElement("div");
        arrow.className =
          "absolute inset-y-0 right-0 flex items-center px-4 pointer-events-none";
        arrow.innerHTML = `
        <svg class="w-5 h-5 text-lightgray" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
    `;

        // Add options
        options.forEach((option) => {
          const optionElement = document.createElement("option");
          optionElement.value = option;
          optionElement.textContent = option;
          if (currentValue === option) {
            optionElement.selected = true;
          }
          select.appendChild(optionElement);
        });

        selectContainer.appendChild(select);
        selectContainer.appendChild(arrow);

        container.appendChild(label);
        container.appendChild(selectContainer);

        return container;
      }

      /**
       * Count the number of active filters
       */
      function getActiveFilterCount(filters) {
        let count = 0;

        if (filters.genre && filters.genre !== "All") {
          count++;
        }

        if (filters.year && filters.year !== "All") {
          count++;
        }

        if (filters.author && filters.author.trim() !== "") {
          count++;
        }

        return count;
      }

      /**
       * Get a summary of applied filters for mobile view
       */
      function getAppliedFiltersSummary(filters) {
        const activeFilters = [];

        if (filters.genre && filters.genre !== "All") {
          activeFilters.push(filters.genre);
        }

        if (filters.year && filters.year !== "All") {
          activeFilters.push(filters.year);
        }

        if (filters.author && filters.author.trim() !== "") {
          activeFilters.push(`Author: ${filters.author}`);
        }

        if (activeFilters.length === 0) {
          return "No filters applied";
        }

        return activeFilters.join(" · ");
      }

      /**
       * SortDropdown component for sorting books
       * @param {String} currentSortBy - Current sort criteria
       * @param {Function} onSortChange - Callback when sort criteria changes
       * @returns {HTMLElement} - Sort dropdown component
       */
      function SortDropdown(currentSortBy, onSortChange) {
        // Create sort container
        const sortContainer = document.createElement("div");
        sortContainer.className = "flex items-center gap-2";

        // Create sort label
        const sortLabel = document.createElement("span");
        sortLabel.className =
          "text-sm font-medium whitespace-nowrap text-lightgray hidden xs:inline";
        sortLabel.textContent = "Sort by:";

        // Create sort select container for styling
        const selectContainer = document.createElement("div");
        selectContainer.className = "relative";

        // Create sort select
        const sortSelect = document.createElement("select");
        sortSelect.className =
          "glassmorphic neomorphic py-2 px-3 pr-8 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none text-white dark-mode-text min-w-[120px] w-full";
        sortSelect.id = "sort-dropdown";
        sortSelect.setAttribute("aria-label", "Sort by");

        // Apply light mode text color via CSS class that will be added to styles.css
        if (document.body.classList.contains("light-mode")) {
          sortSelect.classList.remove("text-white");
          sortSelect.classList.add("text-gray-800");
        }

        // Add dropdown arrow icon
        const arrowIcon = document.createElement("div");
        arrowIcon.className =
          "absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-lightgray";
        arrowIcon.innerHTML = `
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
    `;

        // Add sort options
        const sortOptions = [
          { value: "popularity", label: "Popularity" },
          { value: "rating", label: "Rating" },
          { value: "title", label: "Title" },
          { value: "author", label: "Author" },
          { value: "publishDate", label: "Publish Date" },
        ];

        sortOptions.forEach((option) => {
          const optionElement = document.createElement("option");
          optionElement.value = option.value;
          optionElement.textContent = option.label;
          if (currentSortBy === option.value) {
            optionElement.selected = true;
          }
          sortSelect.appendChild(optionElement);
        });

        // Add change event listener
        sortSelect.addEventListener("change", (e) => {
          onSortChange(e.target.value);
        });

        // Listen for theme changes to update text color
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            if (
              mutation.attributeName === "class" &&
              mutation.target === document.body
            ) {
              if (document.body.classList.contains("light-mode")) {
                sortSelect.classList.remove("text-white");
                sortSelect.classList.add("text-gray-800");
              } else {
                sortSelect.classList.add("text-white");
                sortSelect.classList.remove("text-gray-800");
              }
            }
          });
        });
        observer.observe(document.body, { attributes: true });

        // Assemble sort dropdown
        selectContainer.appendChild(sortSelect);
        selectContainer.appendChild(arrowIcon);
        sortContainer.appendChild(sortLabel);
        sortContainer.appendChild(selectContainer);

        return sortContainer;
      }

      /**
       * ToggleView component for switching between grid and list views
       * @param {String} currentView - Current view mode ('grid' or 'list')
       * @param {Function} onViewChange - Callback when view mode changes
       * @returns {HTMLElement} - Toggle view component
       */
      function ToggleView(currentView, onViewChange) {
        // Create toggle container
        const toggleContainer = document.createElement("div");
        toggleContainer.className = "flex items-center gap-2";

        // Create toggle label
        const toggleLabel = document.createElement("span");
        toggleLabel.className =
          "text-sm font-medium whitespace-nowrap text-lightgray mr-1 hidden xs:inline";
        toggleLabel.textContent = "View:";

        // Create toggle button group
        const buttonGroup = document.createElement("div");
        buttonGroup.className = "flex rounded-lg overflow-hidden neomorphic";

        // Create grid view button
        const gridButton = document.createElement("button");
        gridButton.className = `p-2 transition-colors duration-200 ${
          currentView === "grid" ? "secondary-gradient" : "glassmorphic"
        }`;
        gridButton.setAttribute("aria-label", "Grid view");
        gridButton.setAttribute("title", "Grid view");
        gridButton.innerHTML = `
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
        </svg>
    `;

        gridButton.addEventListener("click", () => {
          if (currentView !== "grid") {
            onViewChange("grid");
          }
        });

        // Create list view button
        const listButton = document.createElement("button");
        listButton.className = `p-2 transition-colors duration-200 ${
          currentView === "list" ? "secondary-gradient" : "glassmorphic"
        }`;
        listButton.setAttribute("aria-label", "List view");
        listButton.setAttribute("title", "List view");
        listButton.innerHTML = `
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
        </svg>
    `;

        listButton.addEventListener("click", () => {
          if (currentView !== "list") {
            onViewChange("list");
          }
        });

        // Assemble button group
        buttonGroup.appendChild(gridButton);
        buttonGroup.appendChild(listButton);

        // Assemble toggle view component
        toggleContainer.appendChild(toggleLabel);
        toggleContainer.appendChild(buttonGroup);

        return toggleContainer;
      }

      /**
       * BookCard component for displaying a book in grid view
       * @param {Object} book - Book data
       * @returns {HTMLElement} - Book card component
       */
      function BookCard(book) {
        // Create the card element
        const card = document.createElement("div");
        card.className =
          "book-card relative neomorphic rounded-xl overflow-hidden h-full flex flex-col transition-all duration-300 hover-scale";
        card.setAttribute("data-book-id", book.id);

        // Check if the book is liked (in favorites)
        const favoriteBooks = JSON.parse(
          localStorage.getItem("favoriteBooks") || "[]"
        );
        const isLiked = favoriteBooks.some((favBook) => favBook.id === book.id);

        // Create cover image with error handling
        const coverImage = document.createElement("div");
        coverImage.className =
          "relative aspect-[2/3] w-full mb-2 overflow-hidden";

        const img = document.createElement("img");
        img.className = "w-full h-full object-cover";
        img.src = book.coverUrl || "";
        img.alt = book.title;
        img.onerror = function () {
          this.src =
            "https://images.unsplash.com/photo-1543002588-bfa74002ed7e?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8Ym9va3xlbnwwfHwwfHx8MA%3D%3D";
        };

        // Add hover overlay with button
        const overlay = document.createElement("div");
        overlay.className =
          "absolute inset-0 bg-gradient-to-t from-darknavy to-transparent opacity-0 flex items-end justify-center p-4 transition-opacity duration-300 group-hover:opacity-100";
        overlay.innerHTML = `
        <button class="view-details-btn px-4 py-2 rounded-lg primary-gradient w-full">
            View Details
        </button>
    `;

        // Add like button that works with local storage
        const likeButton = document.createElement("button");
        likeButton.className = `absolute top-2 right-2 p-2 rounded-full bg-gray-900 bg-opacity-50 z-10 transition-transform duration-300 hover:scale-110 favorite-btn ${
          isLiked ? "is-favorite" : ""
        }`;
        likeButton.innerHTML = `
        <svg class="w-5 h-5 ${
          isLiked ? "text-pink-500 fill-current" : "text-white"
        }" 
            fill="${isLiked ? "currentColor" : "none"}" 
            stroke="currentColor" 
            viewBox="0 0 24 24" 
            xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
            </path>
        </svg>
    `;

        // Add event listener to like button
        likeButton.addEventListener("click", (e) => {
          e.stopPropagation(); // Prevent card click event

          // Toggle like state
          const favorites = JSON.parse(
            localStorage.getItem("favoriteBooks") || "[]"
          );

          if (isLiked) {
            // Remove from favorites
            const updatedFavorites = favorites.filter(
              (favBook) => favBook.id !== book.id
            );
            localStorage.setItem(
              "favoriteBooks",
              JSON.stringify(updatedFavorites)
            );

            // Update UI
            likeButton.classList.remove("is-favorite");
            likeButton
              .querySelector("svg")
              .classList.remove("text-pink-500", "fill-current");
            likeButton.querySelector("svg").classList.add("text-white");
            likeButton.querySelector("svg").setAttribute("fill", "none");
          } else {
            // Add to favorites
            favorites.push(book);
            localStorage.setItem("favoriteBooks", JSON.stringify(favorites));

            // Update UI
            likeButton.classList.add("is-favorite");
            likeButton
              .querySelector("svg")
              .classList.add("text-pink-500", "fill-current");
            likeButton.querySelector("svg").classList.remove("text-white");
            likeButton
              .querySelector("svg")
              .setAttribute("fill", "currentColor");
          }

          // Force remove hover state
          card.classList.remove("hover-scale");
          setTimeout(() => {
            // Check if mouse is still over the element
            if (!card.matches(":hover")) {
              card.classList.add("hover-scale");
            }
          }, 10);

          return false;
        });

        // Append image and overlay to cover container
        coverImage.appendChild(img);
        coverImage.appendChild(overlay);

        // Create book info container
        const infoContainer = document.createElement("div");
        infoContainer.className = "flex-1 px-3 pb-3 flex flex-col";

        // Create title
        const title = document.createElement("h3");
        title.className = "font-bold text-md mb-1 line-clamp-2";
        title.textContent = book.title;

        // Create author
        const author = document.createElement("p");
        author.className = "text-sm text-lightgray mb-2";
        author.textContent = book.author;

        // Create genre badge
        const genre = document.createElement("span");
        const genreClass = getGenreClass(book.genre);
        genre.className = `inline-block px-2 py-1 rounded-md text-xs ${genreClass} text-white mb-2`;
        genre.textContent = book.genre;

        // Create ratings container with both full and condensed versions
        const ratingsContainer = document.createElement("div");
        ratingsContainer.className =
          "flex justify-between items-center mt-auto";

        // Full rating display (for larger screens)
        const fullRating = document.createElement("div");
        fullRating.className = "flex items-center rating-full hidden sm:flex";

        // Generate stars based on rating
        const starsHTML = generateStarsHTML(book.rating);

        fullRating.innerHTML = `
        <div class="flex items-center mr-2">
            ${starsHTML}
        </div>
        <span class="text-xs text-lightgray">(${book.rating.toFixed(1)})</span>
    `;

        // Condensed rating (for smaller screens)
        const condensedRating = document.createElement("div");
        condensedRating.className =
          "flex items-center rating-condensed sm:hidden";
        condensedRating.innerHTML = `
        <svg class="w-4 h-4 text-yellow-500 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
        </svg>
        <span class="text-xs font-medium">${book.rating.toFixed(1)}</span>
    `;

        // Add year published
        const publishYear = document.createElement("span");
        publishYear.className = "text-xs text-lightgray";
        publishYear.textContent = new Date(book.publishDate).getFullYear();

        // Assemble the ratings container
        ratingsContainer.appendChild(fullRating);
        ratingsContainer.appendChild(condensedRating);
        ratingsContainer.appendChild(publishYear);

        // Assemble info container
        infoContainer.appendChild(title);
        infoContainer.appendChild(author);
        // Create a spacer to push genre and ratings to the bottom
        const spacer = document.createElement("div");
        spacer.className = "flex-grow";
        infoContainer.appendChild(spacer);
        infoContainer.appendChild(genre);
        infoContainer.appendChild(ratingsContainer);

        // Assemble card
        card.appendChild(coverImage);
        card.appendChild(likeButton);
        card.appendChild(infoContainer);

        // Add click event to show book details
        card.addEventListener("click", () => {
          showBookDetails(book);
        });

        return card;
      }

      // Generate star rating HTML
      function generateStarsHTML(rating) {
        const fullStars = Math.floor(rating);
        const hasHalfStar = rating % 1 >= 0.5;
        const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);

        let starsHTML = "";

        // Full stars
        for (let i = 0; i < fullStars; i++) {
          starsHTML += `
            <svg class="w-3 h-3 text-yellow-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
            </svg>
        `;
        }

        // Half star
        if (hasHalfStar) {
          starsHTML += `
            <svg class="w-3 h-3 text-yellow-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="half-gradient-${Math.random()}" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="50%" stop-color="currentColor"></stop>
                        <stop offset="50%" stop-color="transparent" stop-opacity="0.5"></stop>
                    </linearGradient>
                </defs>
                <path fill="url(#half-gradient-${Math.random()})" d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
            </svg>
        `;
        }

        // Empty stars
        for (let i = 0; i < emptyStars; i++) {
          starsHTML += `
            <svg class="w-3 h-3 text-gray-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
            </svg>
        `;
        }

        return starsHTML;
      }

      // Book List Item (for list view)
      function BookListItem(book) {
        // Create list item element
        const listItem = document.createElement("div");
        listItem.className =
          "book-list-item flex neomorphic rounded-xl overflow-hidden transition-all duration-300 hover-scale";
        listItem.setAttribute("data-book-id", book.id);

        // Check if the book is liked (in favorites)
        const favoriteBooks = JSON.parse(
          localStorage.getItem("favoriteBooks") || "[]"
        );
        const isLiked = favoriteBooks.some((favBook) => favBook.id === book.id);

        // Create cover image with error handling (smaller for list view)
        const coverImage = document.createElement("div");
        coverImage.className =
          "relative h-28 w-20 sm:h-32 sm:w-24 flex-shrink-0";

        const img = document.createElement("img");
        img.className = "h-full w-full object-cover";
        img.src = book.coverUrl;
        img.alt = book.title;
        img.onerror = function () {
          this.src =
            "https://images.unsplash.com/photo-1543002588-bfa74002ed7e?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8Ym9va3xlbnwwfHwwfHx8MA%3D%3D";
        };

        coverImage.appendChild(img);

        // Create info container
        const infoContainer = document.createElement("div");
        infoContainer.className = "flex-1 flex flex-col p-3 min-w-0"; // min-width prevents text overflow

        // Create title
        const title = document.createElement("h3");
        title.className = "font-bold text-md mb-1 line-clamp-1";
        title.textContent = book.title;

        // Create author
        const author = document.createElement("p");
        author.className = "text-sm text-lightgray mb-2 line-clamp-1";
        author.textContent = book.author;

        // Create metadata container
        const metaContainer = document.createElement("div");
        metaContainer.className =
          "flex flex-wrap items-center gap-2 text-xs mb-2";

        // Create genre badge with gradient background
        const genre = document.createElement("span");
        const genreClass = getGenreClass(book.genre);
        genre.className = `px-2 py-1 rounded-md text-xs ${genreClass} text-white`;
        genre.textContent = book.genre;

        // Add year published
        const publishYear = document.createElement("span");
        publishYear.className = "text-lightgray";
        publishYear.textContent = new Date(book.publishDate).getFullYear();

        // Add rating
        const rating = document.createElement("div");
        rating.className = "flex items-center ml-auto";
        rating.innerHTML = `
        <svg class="w-4 h-4 text-yellow-500 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
        </svg>
        <span class="font-medium">${book.rating.toFixed(1)}</span>
    `;

        // Add description (truncated)
        const description = document.createElement("p");
        description.className =
          "text-sm text-lightgray line-clamp-2 hidden sm:block";
        description.textContent =
          book.description || "No description available.";

        // Assemble meta container
        metaContainer.appendChild(genre);
        metaContainer.appendChild(publishYear);
        metaContainer.appendChild(rating);

        // Assemble info container
        infoContainer.appendChild(title);
        infoContainer.appendChild(author);
        infoContainer.appendChild(metaContainer);
        infoContainer.appendChild(description);

        // Add like button
        const likeButton = document.createElement("button");
        likeButton.className = `flex-shrink-0 p-3 text-lightgray hover:text-white transition-colors duration-300 favorite-btn ${
          isLiked ? "is-favorite" : ""
        }`;
        likeButton.innerHTML = `
        <svg class="w-6 h-6 ${isLiked ? "text-pink-500 fill-current" : ""}" 
            fill="${isLiked ? "currentColor" : "none"}" 
            stroke="currentColor" 
            viewBox="0 0 24 24" 
            xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
            </path>
        </svg>
    `;

        // Add event listener to like button
        likeButton.addEventListener("click", (e) => {
          e.stopPropagation(); // Prevent list item click event

          // Toggle like state
          const favorites = JSON.parse(
            localStorage.getItem("favoriteBooks") || "[]"
          );

          if (isLiked) {
            // Remove from favorites
            const updatedFavorites = favorites.filter(
              (favBook) => favBook.id !== book.id
            );
            localStorage.setItem(
              "favoriteBooks",
              JSON.stringify(updatedFavorites)
            );

            // Update UI
            likeButton.classList.remove("is-favorite");
            likeButton
              .querySelector("svg")
              .classList.remove("text-pink-500", "fill-current");
            likeButton.querySelector("svg").setAttribute("fill", "none");
          } else {
            // Add to favorites
            favorites.push(book);
            localStorage.setItem("favoriteBooks", JSON.stringify(favorites));

            // Update UI
            likeButton.classList.add("is-favorite");
            likeButton
              .querySelector("svg")
              .classList.add("text-pink-500", "fill-current");
            likeButton
              .querySelector("svg")
              .setAttribute("fill", "currentColor");
          }

          // Force remove hover state
          listItem.classList.remove("hover-scale");
          setTimeout(() => {
            // Check if mouse is still over the element
            if (!listItem.matches(":hover")) {
              listItem.classList.add("hover-scale");
            }
          }, 10);

          return false;
        });

        // Assemble list item
        listItem.appendChild(coverImage);
        listItem.appendChild(infoContainer);
        listItem.appendChild(likeButton);

        // Add click event to show book details
        listItem.addEventListener("click", () => {
          showBookDetails(book);
        });

        return listItem;
      }

      // Create a grid of book cards
      function BookGrid(books, viewMode = "grid") {
        const container = document.createElement("div");

        if (books.length === 0) {
          // Show empty state
          container.className = "empty-state text-center py-16";
          container.innerHTML = `
            <div class="text-6xl mb-4 opacity-50">📚</div>
            <h3 class="text-xl font-bold mb-2">No books found</h3>
            <p class="text-lightgray">Try adjusting your filters or search terms</p>
        `;
          return container;
        }

        // Set container class based on view mode
        if (viewMode === "grid") {
          container.className =
            "grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4";

          // Create and append book cards
          books.forEach((book) => {
            container.appendChild(BookCard(book));
          });
        } else {
          container.className = "flex flex-col gap-4";

          // Create and append book list items
          books.forEach((book) => {
            container.appendChild(BookListItem(book));
          });
        }

        return container;
      }

      // Helper function to get genre-specific gradient class
      function getGenreClass(genre) {
        // Map genres to different gradient classes with more vibrant colors
        const genreMap = {
          Fantasy: "bg-gradient-to-r from-purple-600 to-indigo-600",
          "Science Fiction": "bg-gradient-to-r from-blue-600 to-cyan-600",
          Mystery: "bg-gradient-to-r from-indigo-600 to-purple-700",
          Romance: "bg-gradient-to-r from-pink-600 to-rose-600",
          Thriller: "bg-gradient-to-r from-red-600 to-orange-500",
          Horror: "bg-gradient-to-r from-gray-800 to-gray-900",
          "Historical Fiction": "bg-gradient-to-r from-amber-600 to-yellow-500",
          "Non-fiction": "bg-gradient-to-r from-emerald-600 to-teal-600",
          Biography: "bg-gradient-to-r from-amber-600 to-yellow-600",
          "Self-help": "bg-gradient-to-r from-teal-600 to-emerald-600",
          Philosophy: "bg-gradient-to-r from-slate-700 to-slate-900",
          Poetry: "bg-gradient-to-r from-fuchsia-600 to-purple-600",
          Drama: "bg-gradient-to-r from-indigo-700 to-blue-700",
        };

        // Return genre-specific class or default class
        return (
          genreMap[genre] || "bg-gradient-to-r from-violet-600 to-indigo-600"
        );
      }

      /**
       * BookListItem component for displaying a book in list view
       * @param {Object} book - Book data
       * @returns {HTMLElement} - Book list item component
       */
      function BookListItem(book) {
        // Create list item element
        const listItem = document.createElement("div");
        listItem.className =
          "book-list-item flex neomorphic rounded-xl overflow-hidden transition-all duration-300 hover-scale";
        listItem.setAttribute("data-book-id", book.id);

        // Check if the book is liked (in favorites)
        const favoriteBooks = JSON.parse(
          localStorage.getItem("favoriteBooks") || "[]"
        );
        const isLiked = favoriteBooks.some((favBook) => favBook.id === book.id);

        // Create cover image with error handling (smaller for list view)
        const coverImage = document.createElement("div");
        coverImage.className =
          "relative h-28 w-20 sm:h-32 sm:w-24 flex-shrink-0";

        const img = document.createElement("img");
        img.className = "h-full w-full object-cover";
        img.src = book.coverUrl || ""; // Use empty string if undefined
        img.alt = book.title;
        img.onerror = function () {
          this.src =
            "https://images.unsplash.com/photo-1543002588-bfa74002ed7e?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8Ym9va3xlbnwwfHwwfHx8MA%3D%3D";
        };

        coverImage.appendChild(img);

        // Create info container
        const infoContainer = document.createElement("div");
        infoContainer.className = "flex-1 flex flex-col p-3 min-w-0"; // min-width prevents text overflow

        // Create title
        const title = document.createElement("h3");
        title.className = "font-bold text-md mb-1 line-clamp-1";
        title.textContent = book.title;

        // Create author
        const author = document.createElement("p");
        author.className = "text-sm text-lightgray mb-2 line-clamp-1";
        author.textContent = book.author;

        // Create metadata container
        const metaContainer = document.createElement("div");
        metaContainer.className =
          "flex flex-wrap items-center gap-2 text-xs mb-2";

        // Create genre badge with gradient background
        const genre = document.createElement("span");
        const genreClass = getGenreClass(book.genre);
        genre.className = `px-2 py-1 rounded-md text-xs ${genreClass} text-white`;
        genre.textContent = book.genre;

        // Add year published
        const publishYear = document.createElement("span");
        publishYear.className = "text-lightgray";
        publishYear.textContent = new Date(book.publishDate).getFullYear();

        // Add rating
        const rating = document.createElement("div");
        rating.className = "flex items-center ml-auto";
        rating.innerHTML = `
        <svg class="w-4 h-4 text-yellow-500 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
        </svg>
        <span class="font-medium">${book.rating.toFixed(1)}</span>
    `;

        // Add description (truncated)
        const description = document.createElement("p");
        description.className =
          "text-sm text-lightgray line-clamp-2 hidden sm:block";
        description.textContent =
          book.description || "No description available.";

        // Assemble meta container
        metaContainer.appendChild(genre);
        metaContainer.appendChild(publishYear);
        metaContainer.appendChild(rating);

        // Assemble info container
        infoContainer.appendChild(title);
        infoContainer.appendChild(author);
        infoContainer.appendChild(metaContainer);
        infoContainer.appendChild(description);

        // Add like button
        const likeButton = document.createElement("button");
        likeButton.className = `flex-shrink-0 p-3 text-lightgray hover:text-white transition-colors duration-300 favorite-btn ${
          isLiked ? "is-favorite" : ""
        }`;
        likeButton.setAttribute("aria-label", "Toggle favorite");
        likeButton.innerHTML = `
        <svg class="w-6 h-6 ${isLiked ? "text-pink-500 fill-current" : ""}" 
            fill="${isLiked ? "currentColor" : "none"}" 
            stroke="currentColor" 
            viewBox="0 0 24 24" 
            xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
            </path>
        </svg>
    `;

        // Add event listener to like button
        likeButton.addEventListener("click", (e) => {
          e.stopPropagation(); // Prevent list item click event

          // Toggle like state
          const favorites = JSON.parse(
            localStorage.getItem("favoriteBooks") || "[]"
          );
          const bookIsLiked = favorites.some(
            (favBook) => favBook.id === book.id
          );

          if (bookIsLiked) {
            // Remove from favorites
            const updatedFavorites = favorites.filter(
              (favBook) => favBook.id !== book.id
            );
            localStorage.setItem(
              "favoriteBooks",
              JSON.stringify(updatedFavorites)
            );

            // Update UI
            likeButton.classList.remove("is-favorite");
            likeButton
              .querySelector("svg")
              .classList.remove("text-pink-500", "fill-current");
            likeButton.querySelector("svg").setAttribute("fill", "none");
          } else {
            // Add to favorites
            favorites.push(book);
            localStorage.setItem("favoriteBooks", JSON.stringify(favorites));

            // Update UI
            likeButton.classList.add("is-favorite");
            likeButton
              .querySelector("svg")
              .classList.add("text-pink-500", "fill-current");
            likeButton
              .querySelector("svg")
              .setAttribute("fill", "currentColor");
          }
        });

        // Assemble list item
        listItem.appendChild(coverImage);
        listItem.appendChild(infoContainer);
        listItem.appendChild(likeButton);

        // Add click event to show book details
        listItem.addEventListener("click", (e) => {
          // Don't trigger if clicking on like button
          if (!e.target.closest(".favorite-btn")) {
            showBookDetails(book);
          }
        });

        return listItem;
      }

      /**
       * BookGrid component for displaying books in either grid or list view
       * @param {Array} books - Array of book objects
       * @param {String} viewMode - View mode ('grid' or 'list')
       * @returns {HTMLElement} - Book grid component
       */
      function BookGrid(books, viewMode) {
        // Create grid container
        const gridContainer = document.createElement("div");
        gridContainer.className = "mb-20"; // Extra bottom margin for mobile navigation

        // Section header
        const sectionHeader = document.createElement("div");
        sectionHeader.className =
          "flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6";

        // Section title with animation
        const sectionTitle = document.createElement("h2");
        sectionTitle.className =
          "text-2xl md:text-3xl font-bold mb-2 sm:mb-0 relative inline-block";
        sectionTitle.textContent = "Discover Books";

        // Add animated underline
        const underline = document.createElement("span");
        underline.className =
          "absolute -bottom-1 left-0 w-24 h-1 primary-gradient rounded-full";
        sectionTitle.appendChild(underline);

        // Book count
        const bookCount = document.createElement("span");
        bookCount.className = "text-lightgray text-sm";
        bookCount.textContent = `${books.length} book${
          books.length !== 1 ? "s" : ""
        } found`;

        sectionHeader.appendChild(sectionTitle);
        sectionHeader.appendChild(bookCount);

        gridContainer.appendChild(sectionHeader);

        if (books.length === 0) {
          // No books found message
          const noBooks = document.createElement("div");
          noBooks.className =
            "glassmorphic neomorphic rounded-lg flex flex-col items-center justify-center py-16 px-6 text-center";

          const noResultsIcon = document.createElement("div");
          noResultsIcon.className = "text-7xl mb-6 opacity-75";
          noResultsIcon.innerHTML = "📚";

          const noResultsTitle = document.createElement("h3");
          noResultsTitle.className = "text-xl md:text-2xl font-bold mb-2";
          noResultsTitle.textContent = "No books found";

          const noResultsText = document.createElement("p");
          noResultsText.className = "text-lightgray max-w-md mb-6";
          noResultsText.textContent =
            "We couldn't find any books matching your criteria. Try adjusting your filters or search query.";

          const resetButton = document.createElement("button");
          resetButton.className =
            "px-6 py-2 secondary-gradient rounded-full neomorphic hover:opacity-90 transition-opacity";
          resetButton.textContent = "Reset Filters";
          resetButton.addEventListener("click", () => {
            // Reset filters in app state
            appState.searchQuery = "";
            appState.filters = {
              genre: "All",
              author: "",
              year: "All",
            };
            filterAndRenderBooks();
          });

          noBooks.appendChild(noResultsIcon);
          noBooks.appendChild(noResultsTitle);
          noBooks.appendChild(noResultsText);
          noBooks.appendChild(resetButton);

          gridContainer.appendChild(noBooks);
          return gridContainer;
        }

        if (viewMode === "grid") {
          // Grid view
          const gridWrapper = document.createElement("div");
          gridWrapper.className = "glassmorphic neomorphic rounded-lg p-6";

          const grid = document.createElement("div");
          grid.className =
            "grid grid-cols-1 xs:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8";

          // Add book cards to grid
          books.forEach((book) => {
            grid.appendChild(BookCard(book));
          });

          gridWrapper.appendChild(grid);
          gridContainer.appendChild(gridWrapper);
        } else {
          // List view
          const listWrapper = document.createElement("div");
          listWrapper.className = "rounded-lg";

          // List header for desktop view (hidden on mobile)
          const listHeader = document.createElement("div");
          listHeader.className =
            "hidden md:grid grid-cols-12 gap-4 px-6 py-3 mb-4 text-sm text-lightgray font-medium";

          const coverHeader = document.createElement("div");
          coverHeader.className = "col-span-1";
          coverHeader.textContent = "Cover";

          const titleHeader = document.createElement("div");
          titleHeader.className = "col-span-4";
          titleHeader.textContent = "Title";

          const authorHeader = document.createElement("div");
          authorHeader.className = "col-span-3";
          authorHeader.textContent = "Author";

          const genreHeader = document.createElement("div");
          genreHeader.className = "col-span-2";
          genreHeader.textContent = "Genre";

          const ratingHeader = document.createElement("div");
          ratingHeader.className = "col-span-2 text-right";
          ratingHeader.textContent = "Rating";

          listHeader.appendChild(coverHeader);
          listHeader.appendChild(titleHeader);
          listHeader.appendChild(authorHeader);
          listHeader.appendChild(genreHeader);
          listHeader.appendChild(ratingHeader);

          const list = document.createElement("div");
          list.className = "flex flex-col";

          // Add book list items
          books.forEach((book) => {
            list.appendChild(BookListItem(book));
          });

          listWrapper.appendChild(listHeader);
          listWrapper.appendChild(list);
          gridContainer.appendChild(listWrapper);
        }

        return gridContainer;
      }

      /**
       * BookDetail component for displaying detailed information about a book
       * @param {Object} book - Book data
       * @returns {HTMLElement} - Book detail component
       */
      function BookDetail(book) {
        // Get genre-specific class
        const genreClass = getGenreClass(book.genre);

        // Create detail container
        const detailContainer = document.createElement("div");
        detailContainer.className = "flex flex-col md:flex-row gap-8";

        // Left column with book cover and basic info
        const leftColumn = document.createElement("div");
        leftColumn.className =
          "md:w-1/3 flex flex-col items-center md:items-start";

        // Book cover
        const coverContainer = document.createElement("div");
        coverContainer.className =
          "w-full max-w-xs mb-6 neomorphic rounded-lg overflow-hidden";

        const cover = document.createElement("img");
        cover.src = book.cover;
        cover.alt = `${book.title} cover`;
        cover.className = "w-full h-auto object-cover";
        // Add error handler for images
        cover.onerror = function () {
          this.src =
            "https://images.unsplash.com/photo-1543002588-bfa74002ed7e?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80";
        };

        coverContainer.appendChild(cover);

        // Rating display
        const ratingContainer = document.createElement("div");
        ratingContainer.className =
          "flex items-center justify-center md:justify-start mb-4 mt-2";

        const rating = document.createElement("div");
        rating.className = "flex items-center";
        rating.innerHTML = generateStars(book.rating);

        const ratingText = document.createElement("span");
        ratingText.className = "ml-2 font-bold text-lg";
        ratingText.textContent = formatRating(book.rating);

        ratingContainer.appendChild(rating);
        ratingContainer.appendChild(ratingText);

        // Add to favorites button
        const favoriteButton = document.createElement("button");
        favoriteButton.className =
          "w-full py-3 px-6 rounded-lg secondary-gradient hover:opacity-90 neomorphic flex items-center justify-center gap-2 mb-4";
        favoriteButton.innerHTML = `
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
        </svg>
        <span>Add to Favorites</span>
    `;

        // Share button
        const shareButton = document.createElement("button");
        shareButton.className =
          "w-full py-3 px-6 rounded-lg glassmorphic hover:opacity-90 neomorphic flex items-center justify-center gap-2";
        shareButton.innerHTML = `
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
        </svg>
        <span>Share</span>
    `;

        leftColumn.appendChild(coverContainer);
        leftColumn.appendChild(ratingContainer);
        leftColumn.appendChild(favoriteButton);
        leftColumn.appendChild(shareButton);

        // Right column with book details
        const rightColumn = document.createElement("div");
        rightColumn.className = "md:w-2/3";

        // Close button
        const closeButtonContainer = document.createElement("div");
        closeButtonContainer.className = "flex justify-end mb-4";

        const closeButton = document.createElement("button");
        closeButton.className =
          "rounded-full p-2 hover:bg-white hover:bg-opacity-10 transition-colors";
        closeButton.setAttribute("aria-label", "Close");
        closeButton.setAttribute("id", "closeDetailModal");
        closeButton.innerHTML = `
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
    `;

        closeButtonContainer.appendChild(closeButton);

        // Book title
        const title = document.createElement("h2");
        title.className = "text-3xl font-bold mb-2";
        title.textContent = book.title;

        // Book author
        const author = document.createElement("p");
        author.className = "text-xl text-lightgray mb-4";
        author.textContent = `by ${book.author}`;

        // Book metadata
        const metadataContainer = document.createElement("div");
        metadataContainer.className = "flex flex-wrap gap-4 mb-6";

        // Genre badge with genre-specific gradient
        const genreBadge = document.createElement("div");
        genreBadge.className = `${genreClass} px-4 py-2 rounded-full text-sm flex items-center`;
        genreBadge.innerHTML = `
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
        </svg>
        ${book.genre}
    `;

        // Year badge
        const yearBadge = document.createElement("div");
        yearBadge.className =
          "glassmorphic px-4 py-2 rounded-full text-sm flex items-center";
        yearBadge.innerHTML = `
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
        </svg>
        ${book.year}
    `;

        // Popularity badge
        const popularityBadge = document.createElement("div");
        popularityBadge.className =
          "glassmorphic px-4 py-2 rounded-full text-sm flex items-center";
        popularityBadge.innerHTML = `
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
        </svg>
        ${book.popularity}% Popular
    `;

        metadataContainer.appendChild(genreBadge);
        metadataContainer.appendChild(yearBadge);
        metadataContainer.appendChild(popularityBadge);

        // Book description (generated since we don't have it in our data)
        const description = document.createElement("div");
        description.className = "mb-6";

        const descriptionTitle = document.createElement("h3");
        descriptionTitle.className = "text-xl font-bold mb-3";
        descriptionTitle.textContent = "Book Description";

        const descriptionText = document.createElement("p");
        descriptionText.className = "text-lightgray leading-relaxed";
        descriptionText.textContent = generateDescription(book);

        description.appendChild(descriptionTitle);
        description.appendChild(descriptionText);

        // Similar books section
        const similarBooks = document.createElement("div");
        similarBooks.className = "mb-6";

        const similarBooksTitle = document.createElement("h3");
        similarBooksTitle.className = "text-xl font-bold mb-3";
        similarBooksTitle.textContent = "Similar Books";

        const similarBooksGrid = document.createElement("div");
        similarBooksGrid.className = "grid grid-cols-2 md:grid-cols-3 gap-4";

        // Get similar books (same genre, excluding current book)
        const similarBooksList = booksData
          .filter((b) => b.genre === book.genre && b.id !== book.id)
          .slice(0, 3);

        similarBooksList.forEach((similarBook) => {
          // Get genre-specific class for similar book
          const similarBookGenreClass = getGenreClass(similarBook.genre);

          const bookCard = document.createElement("div");
          bookCard.className =
            "bg-darknavy rounded-lg overflow-hidden neomorphic hover-scale";

          const bookContent = document.createElement("div");
          bookContent.className = "flex flex-col h-full";

          const bookCover = document.createElement("img");
          bookCover.src = similarBook.cover;
          bookCover.alt = similarBook.title;
          bookCover.className = "aspect-[2/3] object-cover";

          const bookInfo = document.createElement("div");
          bookInfo.className = "p-3";

          const bookTitle = document.createElement("p");
          bookTitle.className = "font-medium text-sm line-clamp-1";
          bookTitle.textContent = similarBook.title;

          const bookAuthor = document.createElement("p");
          bookAuthor.className = "text-xs text-lightgray truncate";
          bookAuthor.textContent = similarBook.author;

          // Create genre pill
          const bookGenre = document.createElement("span");
          bookGenre.className = `text-xs px-2 py-0.5 mt-2 inline-block rounded-full ${similarBookGenreClass}`;
          bookGenre.textContent = similarBook.genre;

          bookInfo.appendChild(bookTitle);
          bookInfo.appendChild(bookAuthor);
          bookInfo.appendChild(bookGenre);

          bookContent.appendChild(bookCover);
          bookContent.appendChild(bookInfo);

          bookCard.appendChild(bookContent);
          bookCard.addEventListener("click", () => {
            showBookDetail(similarBook);
          });

          similarBooksGrid.appendChild(bookCard);
        });

        similarBooks.appendChild(similarBooksTitle);
        similarBooks.appendChild(similarBooksGrid);

        // Assemble the right column
        rightColumn.appendChild(closeButtonContainer);
        rightColumn.appendChild(title);
        rightColumn.appendChild(author);
        rightColumn.appendChild(metadataContainer);
        rightColumn.appendChild(description);
        rightColumn.appendChild(similarBooks);

        // Assemble the detail container
        detailContainer.appendChild(leftColumn);
        detailContainer.appendChild(rightColumn);

        return detailContainer;
      }

      /**
       * Generate a book description since we don't have one in our data
       */
      function generateDescription(book) {
        const descriptions = [
          `An enthralling ${book.genre.toLowerCase()} novel by acclaimed author ${
            book.author
          } that takes readers on an unforgettable journey. Published in ${
            book.year
          }, this book has captivated audiences worldwide with its compelling narrative and rich character development.`,
          `${
            book.author
          }'s masterpiece explores themes of identity, relationships, and the human condition through a ${book.genre.toLowerCase()} lens. Since its publication in ${
            book.year
          }, it has garnered critical acclaim and a dedicated following.`,
          `A groundbreaking work of ${book.genre.toLowerCase()} that redefines the genre. ${
            book.author
          } weaves an intricate tale that will keep you engaged from beginning to end. Released in ${
            book.year
          }, it quickly became a must-read for literature enthusiasts.`,
        ];

        // Return a random description
        return descriptions[Math.floor(Math.random() * descriptions.length)];
      }

      /**
       * Show book detail modal
       * @param {Object} book - Book to display
       */
      function showBookDetail(book) {
        const modal = document.getElementById("bookDetailModal");
        const content = document.getElementById("bookDetailContent");

        // Clear previous content
        content.innerHTML = "";

        // Add book detail component
        content.appendChild(BookDetail(book));

        // Show modal
        modal.classList.add("show");

        // Prevent body scrolling
        document.body.style.overflow = "hidden";

        // Add close event for the close button
        document
          .getElementById("closeDetailModal")
          .addEventListener("click", hideBookDetail);

        // Also close when clicking outside the content
        modal.addEventListener("click", (e) => {
          if (e.target === modal) {
            hideBookDetail();
          }
        });
      }

      /**
       * Hide book detail modal
       */
      function hideBookDetail() {
        const modal = document.getElementById("bookDetailModal");
        modal.classList.remove("show");

        // Re-enable body scrolling
        document.body.style.overflow = "";
      }

      /**
       * MobileNavigation component for mobile devices
       * @returns {HTMLElement} - Mobile navigation component
       */
      function MobileNavigation() {
        // Check if we're on mobile
        const isMobile = window.innerWidth < 768;

        if (!isMobile) {
          return document.createElement("div"); // Return empty div if not mobile
        }

        // Create navigation container
        const navContainer = document.createElement("div");
        navContainer.className = "mobile-bottom-nav";

        // Home button
        const homeButton = document.createElement("button");
        homeButton.className = "p-2 flex flex-col items-center";
        homeButton.innerHTML = `
        <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
        </svg>
        <span>Home</span>
    `;
        homeButton.addEventListener("click", () => {
          window.scrollTo({ top: 0, behavior: "smooth" });
        });

        // Explore button
        const exploreButton = document.createElement("button");
        exploreButton.className = "p-2 flex flex-col items-center";
        exploreButton.innerHTML = `
        <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 9a2 2 0 114 0 2 2 0 01-4 0z"></path>
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a4 4 0 00-3.446 6.032l-2.261 2.26a1 1 0 101.414 1.415l2.261-2.261A4 4 0 1011 5z" clip-rule="evenodd"></path>
        </svg>
        <span>Explore</span>
    `;

        // Categories button
        const categoriesButton = document.createElement("button");
        categoriesButton.className = "p-2 flex flex-col items-center";
        categoriesButton.innerHTML = `
        <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
        </svg>
        <span>Categories</span>
    `;

        // Favorites button
        const favoritesButton = document.createElement("button");
        favoritesButton.className = "p-2 flex flex-col items-center";
        favoritesButton.innerHTML = `
        <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
        </svg>
        <span>Favorites</span>
    `;

        // Profile button
        const profileButton = document.createElement("button");
        profileButton.className = "p-2 flex flex-col items-center";
        profileButton.innerHTML = `
        <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
        </svg>
        <span>Profile</span>
    `;

        // Assemble navigation
        navContainer.appendChild(homeButton);
        navContainer.appendChild(exploreButton);
        navContainer.appendChild(categoriesButton);
        navContainer.appendChild(favoritesButton);
        navContainer.appendChild(profileButton);

        return navContainer;
      }

      // Function to add padding to accommodate the mobile navigation
      function adjustForMobileNav() {
        const isMobile = window.innerWidth < 768;

        if (isMobile) {
          // Add padding to the bottom of the body to prevent content from being hidden behind nav
          document.body.style.paddingBottom = "70px";
        } else {
          document.body.style.paddingBottom = "0";
        }
      }

      // Listen for resize events to adjust layout
      window.addEventListener("resize", adjustForMobileNav);

      // App state
      const appState = {
        books: [],
        filteredBooks: [],
        genres: [],
        years: [],
        ratings: [],
        currentPage: "explore",
        selectedGenre: null,
        viewMode: "grid",
        sortOption: "rating",
        sortDirection: "desc",
        favorites: [],
        activeTab: "explore",
        isMobile: window.innerWidth < 768,
      };

      // DOM elements
      const appContainer = document.getElementById("app");
      const headerContainer = document.createElement("header");
      const mainContainer = document.createElement("main");
      const controlsContainer = document.createElement("div");
      const filterSortContainer = document.createElement("div");
      const navContainer = document.createElement("nav");
      const desktopNavContainer = document.createElement("nav");

      // Genre image mapping for mobile category display
      const genreImages = {
        Mystery:
          "https://images.unsplash.com/photo-1588497859490-85d1c17db96d?q=80&w=800",
        "Science Fiction":
          "https://images.unsplash.com/photo-1446776877081-d282a0f896e2?q=80&w=800",
        Fantasy:
          "https://images.unsplash.com/photo-1518709268805-4e9042af9f23?q=80&w=800",
        Romance:
          "https://images.unsplash.com/photo-1474552226712-ac0f0961a954?q=80&w=800",
        Thriller:
          "https://images.unsplash.com/photo-1611915387288-fd8d2f5f928b?q=80&w=800",
        "Non-fiction":
          "https://images.unsplash.com/photo-1457369804613-52c61a468e7d?q=80&w=800",
        Drama:
          "https://images.unsplash.com/photo-1503095396549-807759245b35?q=80&w=800",
        "Self-help":
          "https://images.unsplash.com/photo-1541199249251-f713e6145474?q=80&w=800",
        Biography:
          "https://images.unsplash.com/photo-1511108690759-009324a90311?q=80&w=800",
      };

      const booksData = [
        {
          id: 1,
          title: "The Silent Echo",
          author: "Elena Blackwood",
          publishDate: "2022-03-15",
          genre: "Mystery",
          rating: 4.7,
          pages: 324,
          popularity: 85,
          description:
            "A thrilling mystery set in a small coastal town, where a decades-old disappearance resurfaces after a series of strange events.",
          coverUrl:
            "https://images.unsplash.com/photo-1544947950-fa07a98d237f?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80",
        },
        {
          id: 2,
          title: "Beyond the Horizon",
          author: "Marcus Reed",
          publishDate: "2021-07-22",
          genre: "Science Fiction",
          rating: 4.5,
          pages: 412,
          popularity: 92,
          description:
            "An epic space adventure that explores the boundaries of human existence and the possibilities of interstellar travel.",
          coverUrl:
            "https://images.unsplash.com/photo-1532012197267-da84d127e765?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80",
        },
        {
          id: 3,
          title: "The Last Kingdom",
          author: "Sarah Jensen",
          publishDate: "2020-11-05",
          genre: "Fantasy",
          rating: 4.8,
          pages: 528,
          popularity: 78,
          description:
            "In a world divided by ancient magic and modern ambitions, one unlikely hero must unite the realms before darkness consumes them all.",
          coverUrl:
            "https://images.unsplash.com/photo-1629992101753-56d196c8aabb?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80",
        },
        {
          id: 4,
          title: "Midnight in Paris",
          author: "Antoine Dubois",
          publishDate: "2019-02-14",
          genre: "Romance",
          rating: 4.3,
          pages: 286,
          popularity: 87,
          description:
            "A passionate love story set against the backdrop of Paris, where art, history, and desire intertwine under the City of Light's enchanting spell.",
          coverUrl:
            "https://images.unsplash.com/photo-1610116306796-6fea9f4fae38?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80",
        },
        {
          id: 5,
          title: "The Art of Strategy",
          author: "David Chen",
          publishDate: "2022-01-18",
          genre: "Non-fiction",
          rating: 4.6,
          pages: 344,
          popularity: 75,
          description:
            "A comprehensive guide to strategic thinking in business, politics, and life, drawing from both ancient wisdom and contemporary research.",
          coverUrl:
            "https://images.unsplash.com/photo-1589998059171-988d887df646?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80",
        },
        {
          id: 6,
          title: "Shadows of the Past",
          author: "Isabella Martinez",
          publishDate: "2021-09-30",
          genre: "Thriller",
          rating: 4.4,
          pages: 376,
          popularity: 83,
          description:
            "A psychological thriller where a detective must confront her own traumatic history to catch a killer who seems to know her deepest secrets.",
          coverUrl:
            "https://images.unsplash.com/photo-1587876931567-564ce588bfbd?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80",
        },
        {
          id: 7,
          title: "The Summer House",
          author: "Emma Collins",
          publishDate: "2020-06-12",
          genre: "Drama",
          rating: 4.2,
          pages: 312,
          popularity: 68,
          description:
            "A moving family drama about reconciliation and forgiveness, set in a coastal summer retreat where three generations gather to heal old wounds.",
          coverUrl:
            "https://images.unsplash.com/photo-1610555356070-d0efb6505f81?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80",
        },
        {
          id: 8,
          title: "Digital Minimalism",
          author: "Thomas Newport",
          publishDate: "2019-04-23",
          genre: "Self-help",
          rating: 4.5,
          pages: 264,
          popularity: 81,
          description:
            "A practical guide to reclaiming focus and attention in an increasingly distracted world, offering concrete strategies for digital decluttering.",
          coverUrl:
            "https://images.unsplash.com/photo-1553729459-efe14ef6055d?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80",
        },
        {
          id: 9,
          title: "The Quantum Paradox",
          author: "Richard Harris",
          publishDate: "2022-05-08",
          genre: "Science Fiction",
          rating: 4.9,
          pages: 488,
          popularity: 95,
          description:
            "When a quantum physics experiment goes awry, a scientist finds himself navigating parallel realities, searching for the one where he truly belongs.",
          coverUrl:
            "https://images.unsplash.com/photo-1614728263952-84ea256f9679?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80",
        },
        {
          id: 10,
          title: "The Hidden Garden",
          author: "Olivia Wilson",
          publishDate: "2020-08-16",
          genre: "Mystery",
          rating: 4.4,
          pages: 336,
          popularity: 79,
          description:
            "When a rare botanical manuscript is stolen, a librarian and a botanical historian team up to solve the mystery, uncovering secrets hidden in gardens across Europe.",
          coverUrl:
            "https://images.unsplash.com/photo-1512820790803-83ca734da794?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&q=80",
        },
      ];

      // Initialize app
      async function initApp() {
        try {
          // Check for theme preference immediately
          if (localStorage.getItem("darkMode") === "false") {
            document.body.classList.add("light-mode");
          }

          showLoader();

          // Check if we're on mobile
          checkDeviceType();

          // Add resize listener to update device type
          window.addEventListener("resize", checkDeviceType);

          // Render the basic UI structure
          renderHeader();
          renderNavigation();

          // Set up event listeners
          setupEventListeners();

          // Use embedded booksData directly (no fetch needed)
          appState.books = booksData;
          appState.filteredBooks = [...booksData];

          // Extract and sort unique genres, years, and ratings for filters
          appState.genres = [
            ...new Set(booksData.map((book) => book.genre)),
          ].sort();
          appState.years = [
            ...new Set(
              booksData.map((book) => new Date(book.publishDate).getFullYear())
            ),
          ]
            .sort()
            .reverse();
          appState.ratings = [5, 4, 3, 2, 1];

          // Load favorites from localStorage
          appState.favorites = JSON.parse(
            localStorage.getItem("favoriteBooks") || "[]"
          );

          // Check URL hash for navigation
          handleNavigation();

          // Add hash change listener for navigation
          window.addEventListener("hashchange", handleNavigation);

          hideLoader();
        } catch (error) {
          console.error("Error initializing app:", error);
          showError("Failed to initialize the app. Please try again.");
          hideLoader();
        }
      }

      // Check and update device type
      function checkDeviceType() {
        const wasMobile = appState.isMobile;
        appState.isMobile = window.innerWidth < 768;

        // If device type changed, rerender navigation
        if (wasMobile !== appState.isMobile) {
          renderNavigation();
          // Re-render current page if we're on the categories page
          if (appState.currentPage === "categories") {
            showCategoriesPage();
          }
        }
      }

      // Render header
      function renderHeader() {
        headerContainer.innerHTML = "";
        headerContainer.className =
          "flex justify-between items-center p-4 mb-6 neomorphic rounded-xl mobile-optimized-header";

        // Logo
        const logo = document.createElement("div");
        logo.className = "text-xl font-bold mobile-logo-text";
        logo.textContent = "BookDiscovery";

        // Desktop navigation
        desktopNavContainer.className =
          "desktop-nav hidden md:flex space-x-6 ml-8";
        desktopNavContainer.innerHTML = `
        <a href="#explore" class="nav-link ${
          appState.currentPage === "explore" ? "active" : ""
        }">Explore</a>
        <a href="#categories" class="nav-link ${
          appState.currentPage === "categories" ? "active" : ""
        }">Categories</a>
        <a href="#favorites" class="nav-link ${
          appState.currentPage === "favorites" ? "active" : ""
        }">Favorites</a>
    `;

        // Search bar
        const searchBar = document.createElement("div");
        searchBar.className = "flex-1 mx-4 md:mx-8 relative mobile-search-bar";

        const searchInput = document.createElement("input");
        searchInput.type = "text";
        searchInput.placeholder = "Search";
        searchInput.className =
          "w-full bg-gray-800 rounded-full py-2 px-4 pl-10 text-white focus:outline-none focus:ring-2 focus:ring-purple-500 mobile-search-input";
        searchInput.addEventListener("input", handleSearch);

        const searchIcon = document.createElement("div");
        searchIcon.className =
          "absolute left-3 top-1/2 transform -translate-y-1/2 text-lightgray mobile-search-icon";
        searchIcon.innerHTML = `
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
    `;

        searchBar.appendChild(searchIcon);
        searchBar.appendChild(searchInput);

        // Theme toggle with appropriate icon based on current theme
        const themeToggle = document.createElement("button");
        themeToggle.id = "desktopDarkModeToggle";

        // Show sun icon in dark mode, moon icon in light mode
        const isDarkMode = !document.body.classList.contains("light-mode");

        themeToggle.className = isDarkMode
          ? "p-2 rounded-full hover:bg-gray-800 mobile-theme-toggle"
          : "p-2 rounded-full hover:bg-gray-300 mobile-theme-toggle";
        themeToggle.innerHTML = isDarkMode
          ? `<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
              <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
           </svg>`
          : `<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path>
           </svg>`;

        themeToggle.addEventListener("click", toggleTheme);

        // Left container (logo + desktop nav)
        const leftContainer = document.createElement("div");
        leftContainer.className = "flex items-center mobile-logo-container";
        leftContainer.appendChild(logo);
        leftContainer.appendChild(desktopNavContainer);

        // Right container (theme toggle)
        const rightContainer = document.createElement("div");
        rightContainer.className = "flex items-center mobile-right-controls";
        rightContainer.appendChild(themeToggle);

        // Assemble header
        headerContainer.appendChild(leftContainer);
        headerContainer.appendChild(searchBar);
        headerContainer.appendChild(rightContainer);

        // Add the header to the app container if not already added
        if (!appContainer.contains(headerContainer)) {
          appContainer.appendChild(headerContainer);
        }

        // Create and append mobile navigation
        renderMobileNavigation();
      }

      // Render mobile navigation
      function renderMobileNavigation() {
        // Remove existing mobile navigation if present
        const existingNav = document.querySelector(".mobile-bottom-nav");
        if (existingNav) {
          existingNav.remove();
        }

        const mobileNav = document.createElement("div");
        mobileNav.className = "mobile-bottom-nav md:hidden";

        // Create the buttons with appropriate classes based on current page
        const exploreButton = createNavButton(
          "explore",
          "Explore",
          '<path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"></path>'
        );

        const categoriesButton = createNavButton(
          "categories",
          "Categories",
          '<path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"></path>'
        );

        const favoritesButton = createNavButton(
          "favorites",
          "Favorites",
          '<path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path>'
        );

        // Add the buttons to the nav
        mobileNav.appendChild(exploreButton);
        mobileNav.appendChild(categoriesButton);
        mobileNav.appendChild(favoritesButton);

        // Append to body
        document.body.appendChild(mobileNav);

        // Update active state
        updateActiveNavTab();
      }

      // Create navigation button with consistent class structure
      function createNavButton(page, label, svgPath) {
        const button = document.createElement("button");
        button.className = `nav-item nav-${page} px-4 py-2 bg-transparent text-lightgray`;

        button.innerHTML = `
        <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            ${svgPath}
        </svg>
        <span class="text-xs">${label}</span>
    `;

        button.addEventListener("click", () => {
          window.location.hash = page;
        });

        return button;
      }

      // Toggle between light and dark theme
      function toggleTheme() {
        const isCurrentlyDark = !document.body.classList.contains("light-mode");
        const themeToggle = document.getElementById("desktopDarkModeToggle");

        // Add animation class first
        if (themeToggle) {
          themeToggle.classList.add("animating");
        }

        // Short delay to allow animation to start
        setTimeout(() => {
          // Toggle the class
          document.body.classList.toggle("light-mode");

          // Save preference to localStorage
          const isDarkMode = !document.body.classList.contains("light-mode");
          localStorage.setItem("darkMode", isDarkMode);

          // Update theme toggle icon with animation
          if (themeToggle) {
            setTimeout(() => {
              // Update the hover class based on the current theme
              themeToggle.className = isDarkMode
                ? "p-2 rounded-full hover:bg-gray-300"
                : "p-2 rounded-full hover:bg-gray-100";

              // Update the icon - show sun icon in dark mode, moon icon in light mode
              themeToggle.innerHTML = isDarkMode
                ? `<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                          <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path>
                       </svg>`
                : `<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                          <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                       </svg>`;

              // Remove animation class to show new icon
              themeToggle.classList.remove("animating");
            }, 300); // This should match the animation duration
          }

          // Refresh the current page to apply theme fully with smooth transition
          if (appState.currentPage === "explore") {
            showExplorePage();
          } else if (appState.currentPage === "categories") {
            showCategoriesPage();
          } else if (appState.currentPage === "favorites") {
            showFavoritesPage();
          }
        }, 50);
      }

      // Handle search input
      function handleSearch(e) {
        const searchQuery = e.target.value.toLowerCase().trim();

        if (searchQuery === "") {
          // If search is cleared
          if (appState.selectedGenre) {
            // Keep genre filter if it exists
            appState.filteredBooks = appState.books.filter(
              (book) => book.genre === appState.selectedGenre
            );
          } else {
            // Otherwise show all books
            appState.filteredBooks = [...appState.books];
          }
        } else {
          // Filter books based on search query
          let searchBase = appState.books;

          // If we have a genre filter, apply it to the search too
          if (appState.selectedGenre) {
            searchBase = searchBase.filter(
              (book) => book.genre === appState.selectedGenre
            );
          }

          // Then filter by search query
          appState.filteredBooks = searchBase.filter(
            (book) =>
              book.title.toLowerCase().includes(searchQuery) ||
              book.author.toLowerCase().includes(searchQuery) ||
              book.genre.toLowerCase().includes(searchQuery) ||
              // Add year search - convert publishDate to string and check if it includes the query
              (book.publishDate &&
                book.publishDate.toString().includes(searchQuery))
          );
        }

        // Update display based on current page with animation
        if (appState.currentPage === "explore") {
          // Add animation classes to book elements before redrawing
          animateBookChanges(appState.filteredBooks);

          // Short delay to allow animations to run
          setTimeout(() => {
            showExplorePage();
          }, 50);
        } else if (appState.currentPage === "favorites") {
          // Filter favorites based on search query
          const favoriteBooks = JSON.parse(
            localStorage.getItem("favoriteBooks") || "[]"
          );

          const filteredFavorites =
            searchQuery === ""
              ? favoriteBooks
              : favoriteBooks.filter(
                  (book) =>
                    book.title.toLowerCase().includes(searchQuery) ||
                    book.author.toLowerCase().includes(searchQuery) ||
                    book.genre.toLowerCase().includes(searchQuery) ||
                    // Add year search - convert publishDate to string and check if it includes the query
                    (book.publishDate &&
                      book.publishDate.toString().includes(searchQuery))
                );

          // Add animation classes before redrawing
          animateBookChanges(filteredFavorites);

          // Short delay to allow animations to run
          setTimeout(() => {
            // Update favorites page with filtered results
            showFavoritesPageWithFilter(filteredFavorites);
          }, 50);
        } else if (appState.currentPage === "categories") {
          // Reload the page with the filter applied
          setTimeout(() => {
            showCategoriesPageWithFilter(searchQuery);
          }, 50);
        }

        // Update custom cursor position if enabled
        updateCustomCursor(e.target);
      }

      // Show favorites page with filtered results
      function showFavoritesPageWithFilter(filteredFavorites) {
        appState.currentPage = "favorites";
        updateActiveNavTab();

        // Clear main container
        mainContainer.innerHTML = "";
        mainContainer.className = "container mx-auto px-4 pt-6 pb-24";

        // Prepare app structure
        if (!appContainer.contains(headerContainer)) {
          appContainer.appendChild(headerContainer);
        }

        if (!appContainer.contains(mainContainer)) {
          appContainer.appendChild(mainContainer);
        }

        // Create favorites header
        const favoritesHeader = document.createElement("div");
        favoritesHeader.className = "mb-6";

        const favoritesTitle = document.createElement("h2");
        favoritesTitle.className = "text-2xl md:text-3xl font-bold mb-2";
        favoritesTitle.textContent = "Favorite Books";

        const favoritesDescription = document.createElement("p");
        favoritesDescription.className = "text-lightgray";
        favoritesDescription.textContent = "Your collection of loved books";

        favoritesHeader.appendChild(favoritesTitle);
        favoritesHeader.appendChild(favoritesDescription);
        mainContainer.appendChild(favoritesHeader);

        // Create controls section
        const controlsSection = document.createElement("div");
        controlsSection.className =
          "mb-6 flex flex-wrap justify-between items-center gap-4 controls-container";

        // Create view toggle
        const viewToggle = document.createElement("div");
        viewToggle.className =
          "view-toggle flex bg-gray-800 rounded-lg overflow-hidden p-1";

        const gridButton = document.createElement("button");
        gridButton.className = `p-2 ${
          appState.viewMode === "grid"
            ? "bg-gray-700 text-white"
            : "text-lightgray hover:text-white"
        } rounded-md`;
        gridButton.innerHTML = `
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
        </svg>
    `;

        const listButton = document.createElement("button");
        listButton.className = `p-2 ${
          appState.viewMode === "list"
            ? "bg-gray-700 text-white"
            : "text-lightgray hover:text-white"
        } rounded-md`;
        listButton.innerHTML = `
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
        </svg>
    `;

        // Add event listeners for view toggle
        gridButton.addEventListener("click", () => {
          if (appState.viewMode !== "grid") {
            appState.viewMode = "grid";
            showFavoritesPage();
          }
        });

        listButton.addEventListener("click", () => {
          if (appState.viewMode !== "list") {
            appState.viewMode = "list";
            showFavoritesPage();
          }
        });

        viewToggle.appendChild(gridButton);
        viewToggle.appendChild(listButton);

        // Create sort controls
        const sortControls = createSortControls();

        // Assemble controls
        controlsSection.appendChild(viewToggle);
        controlsSection.appendChild(sortControls);
        mainContainer.appendChild(controlsSection);

        // Show empty state if no favorites
        if (filteredFavorites.length === 0) {
          const emptyState = document.createElement("div");
          emptyState.className = "text-center py-16";
          emptyState.innerHTML = `
            <div class="text-6xl mb-4 opacity-50">📚</div>
            <h3 class="text-xl font-bold mb-2">No books found</h3>
            <p class="text-lightgray mb-4">Try adjusting your filters or search terms</p>
            <a href="#explore" class="inline-block px-4 py-2 primary-gradient rounded-lg">Explore Books</a>
        `;
          mainContainer.appendChild(emptyState);
          return;
        }

        // Sort favorites
        const sortedFavorites = sortBooks(
          filteredFavorites,
          appState.sortOption,
          appState.sortDirection
        );

        // Create book grid with the selected view mode
        const bookContainer = BookGrid(sortedFavorites, appState.viewMode);
        mainContainer.appendChild(bookContainer);
      }

      // Show categories page with search filter
      function showCategoriesPageWithFilter(searchQuery) {
        appState.currentPage = "categories";
        updateActiveNavTab();

        // Clear main container
        mainContainer.innerHTML = "";
        mainContainer.className = "container mx-auto px-4 pt-6 pb-24";

        // Prepare app structure
        if (!appContainer.contains(headerContainer)) {
          appContainer.appendChild(headerContainer);
        }

        if (!appContainer.contains(mainContainer)) {
          appContainer.appendChild(mainContainer);
        }

        // Create categories header
        const categoriesHeader = document.createElement("div");
        categoriesHeader.className = "mb-6";

        const categoriesTitle = document.createElement("h2");
        categoriesTitle.className = "text-2xl md:text-3xl font-bold mb-2";
        categoriesTitle.textContent = "Categories";

        const categoriesDescription = document.createElement("p");
        categoriesDescription.className = "text-lightgray";
        categoriesDescription.textContent = "Browse books by genre";

        categoriesHeader.appendChild(categoriesTitle);
        categoriesHeader.appendChild(categoriesDescription);

        // Create categories list - now full-width cards instead of grid
        const categoriesList = document.createElement("div");
        categoriesList.className = "space-y-4"; // Vertical spacing between cards

        // Get unique genres and sort them alphabetically
        let genres = [
          ...new Set(appState.books.map((book) => book.genre)),
        ].sort();

        // Filter genres based on search query if provided
        if (searchQuery) {
          genres = genres.filter((genre) =>
            genre.toLowerCase().includes(searchQuery.toLowerCase())
          );
        }

        // Show empty state if no genres match the search
        if (genres.length === 0) {
          const emptyState = document.createElement("div");
          emptyState.className = "text-center py-16";
          emptyState.innerHTML = `
            <div class="text-6xl mb-4 opacity-50">📚</div>
            <h3 class="text-xl font-bold mb-2">No categories found</h3>
            <p class="text-lightgray mb-4">Try adjusting your search terms</p>
            <button id="reset-category-search" class="inline-block px-4 py-2 primary-gradient rounded-lg">Show All Categories</button>
          `;
          mainContainer.appendChild(categoriesHeader);
          mainContainer.appendChild(emptyState);

          // Add event listener to reset search
          document
            .getElementById("reset-category-search")
            .addEventListener("click", () => {
              const searchInput = document.querySelector(
                'input[type="text"][placeholder*="Search"]'
              );
              if (searchInput) {
                searchInput.value = "";
                searchInput.dispatchEvent(new Event("input"));
              }
            });

          return;
        }

        // Create category tiles
        genres.forEach((genre) => {
          const genreCard = createCategoryCard(genre);
          categoriesList.appendChild(genreCard);
        });

        // Assemble categories page
        mainContainer.appendChild(categoriesHeader);
        mainContainer.appendChild(categoriesList);
      }

      // Animate book changes when filtering
      function animateBookChanges(filteredBooks) {
        // Get all current book elements
        const bookElements = document.querySelectorAll(
          ".book-card, .book-list-item"
        );

        bookElements.forEach((element) => {
          const bookId = element.getAttribute("data-book-id");
          const isInFiltered = filteredBooks.some(
            (book) => book.id.toString() === bookId
          );

          if (!isInFiltered) {
            element.classList.add("filtered-out");
          } else {
            element.classList.add("filtered-in");
          }
        });
      }

      // Render navigation tabs
      function renderNavigation() {
        navContainer.innerHTML = `
        <div class="mobile-nav-header">
            <div class="logo" onclick="navigateTo('home')">
                <h1>BookDiscover</h1>
            </div>
            <div class="close-menu-button">
                <i class="fas fa-times"></i>
            </div>
        </div>
        <div class="nav-links">
            <a href="#" class="nav-link" data-page="home"><i class="fas fa-home"></i> Home</a>
            <a href="#" class="nav-link" data-page="favorites"><i class="fas fa-heart"></i> Favorites</a>
            <a href="#" class="nav-link" data-page="categories"><i class="fas fa-tags"></i> Categories</a>
            <a href="#" class="nav-link" data-page="recommended"><i class="fas fa-star"></i> Recommended</a>
        </div>
        <div class="nav-footer">
            <div class="theme-toggle-container">
                <div class="theme-icon sun"><i class="fas fa-sun"></i></div>
                <div class="theme-toggle" id="mobile-theme-toggle"></div>
                <div class="theme-icon moon"><i class="fas fa-moon"></i></div>
            </div>
        </div>
    `;
      }

      // Handle navigation based on URL hash
      function handleNavigation() {
        const hash = window.location.hash.slice(1);

        // Default to explore if no hash is present
        switch (hash) {
          case "categories":
            appState.currentPage = "categories";
            showCategoriesPage();
            break;
          case "favorites":
            appState.currentPage = "favorites";
            showFavoritesPage();
            break;
          default:
            appState.currentPage = "explore";

            // Check if we're coming from a category selection
            const selectedGenre = sessionStorage.getItem("selectedGenre");
            if (selectedGenre) {
              // Apply the genre filter
              appState.selectedGenre = selectedGenre;
              appState.filteredBooks = appState.books.filter(
                (book) => book.genre === selectedGenre
              );
            } else {
              // If no genre filter, show all books
              appState.filteredBooks = [...appState.books];
            }

            showExplorePage();
        }

        // Update active navigation tab
        updateActiveNavTab();
      }

      // Update active navigation tab
      function updateActiveNavTab() {
        if (appState.isMobile) {
          // Update mobile navigation tabs
          document.querySelectorAll(".nav-item").forEach((tab) => {
            tab.classList.remove(
              "active",
              "primary-gradient",
              "bg-gray-800",
              "-mt-6",
              "px-6",
              "py-3",
              "rounded-full"
            );
            tab.classList.add("px-4", "py-2", "bg-transparent");
            tab
              .querySelector("span")
              .classList.remove("text-sm", "font-medium");
            tab.querySelector("span").classList.add("text-xs");
            tab.classList.add("text-lightgray");
          });

          const currentTab = document.querySelector(
            `.nav-${appState.currentPage}`
          );
          if (currentTab) {
            currentTab.classList.add(
              "active",
              "primary-gradient",
              "-mt-6",
              "px-6",
              "py-3",
              "rounded-full"
            );
            currentTab.classList.remove(
              "px-4",
              "py-2",
              "bg-transparent",
              "text-lightgray"
            );
            currentTab
              .querySelector("span")
              .classList.add("text-sm", "font-medium");
            currentTab.querySelector("span").classList.remove("text-xs");
            currentTab.classList.add("text-white");
          }
        } else {
          // Update desktop navigation tabs
          document.querySelectorAll(".desktop-nav .nav-link").forEach((tab) => {
            tab.classList.remove("active");
          });

          const currentTab = document.querySelector(
            `.desktop-nav .nav-link[href="#${appState.currentPage}"]`
          );
          if (currentTab) {
            currentTab.classList.add("active");
          }
        }
      }

      // Show the explore page with filters, sorting, and book grid
      function showExplorePage() {
        appState.currentPage = "explore";
        updateActiveNavTab();

        // Clear main container
        mainContainer.innerHTML = "";
        mainContainer.className = "container mx-auto px-4 pt-6 pb-24";

        // Prepare app structure
        if (!appContainer.contains(headerContainer)) {
          appContainer.appendChild(headerContainer);
        }

        if (!appContainer.contains(mainContainer)) {
          appContainer.appendChild(mainContainer);
        }

        // Create page header
        const pageHeader = document.createElement("div");
        pageHeader.className = "mb-6";

        const pageTitle = document.createElement("h2");
        pageTitle.className = "text-2xl md:text-3xl font-bold mb-2";

        // Update title if a genre is selected
        if (appState.selectedGenre) {
          pageTitle.textContent = `${appState.selectedGenre} Books`;
        } else {
          pageTitle.textContent = "Explore Books";
        }

        const pageDescription = document.createElement("p");
        pageDescription.className = "text-lightgray";

        // Update description if a genre is selected
        if (appState.selectedGenre) {
          pageDescription.textContent = `Discover popular ${appState.selectedGenre} books`;

          // Add clear filter button
          const clearFilterButton = document.createElement("button");
          clearFilterButton.className =
            "ml-2 text-sm underline text-blue-400 hover:text-blue-300";
          clearFilterButton.textContent = "Clear filter";
          clearFilterButton.addEventListener("click", () => {
            // Clear the genre filter
            appState.selectedGenre = null;
            sessionStorage.removeItem("selectedGenre");
            appState.filteredBooks = [...appState.books];

            // Refresh the page
            showExplorePage();
          });

          pageDescription.appendChild(clearFilterButton);
        } else {
          pageDescription.textContent = "Discover your next favorite read";
        }

        pageHeader.appendChild(pageTitle);
        pageHeader.appendChild(pageDescription);
        mainContainer.appendChild(pageHeader);

        // Create controls section
        const controlsSection = document.createElement("div");
        controlsSection.className =
          "mb-6 flex flex-wrap justify-between items-center gap-4 controls-container";

        // Create view toggle
        const viewToggle = document.createElement("div");
        viewToggle.className =
          "view-toggle flex bg-gray-800 rounded-lg overflow-hidden p-1";

        const gridButton = document.createElement("button");
        gridButton.className = `p-2 ${
          appState.viewMode === "grid"
            ? "bg-gray-700 text-white"
            : "text-lightgray hover:text-white"
        } rounded-md`;
        gridButton.innerHTML = `
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
        </svg>
    `;

        const listButton = document.createElement("button");
        listButton.className = `p-2 ${
          appState.viewMode === "list"
            ? "bg-gray-700 text-white"
            : "text-lightgray hover:text-white"
        } rounded-md`;
        listButton.innerHTML = `
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
        </svg>
    `;

        // Add event listeners for view toggle
        gridButton.addEventListener("click", () => {
          if (appState.viewMode !== "grid") {
            appState.viewMode = "grid";
            showExplorePage();
          }
        });

        listButton.addEventListener("click", () => {
          if (appState.viewMode !== "list") {
            appState.viewMode = "list";
            showExplorePage();
          }
        });

        viewToggle.appendChild(gridButton);
        viewToggle.appendChild(listButton);

        // Create sort controls
        const sortControls = createSortControls();

        // Assemble controls
        controlsSection.appendChild(viewToggle);
        controlsSection.appendChild(sortControls);
        mainContainer.appendChild(controlsSection);

        // Sort books
        const sortedBooks = sortBooks(
          appState.filteredBooks,
          appState.sortOption,
          appState.sortDirection
        );

        // Create book grid with the selected view mode
        const bookContainer = BookGrid(sortedBooks, appState.viewMode);
        mainContainer.appendChild(bookContainer);
      }

      // Create custom sort dropdown
      function createSortControls() {
        const sortControls = document.createElement("div");
        sortControls.className = "sort-controls relative";

        // Current sort option display
        const sortDisplay = document.createElement("button");
        sortDisplay.className =
          "flex items-center bg-gray-800 rounded-lg px-4 py-2 min-w-[160px] justify-between";
        sortDisplay.setAttribute("aria-expanded", "false");
        sortDisplay.innerHTML = `
        <span class="mr-2">Sort: <span class="font-medium">${getSortOptionLabel(
          appState.sortOption
        )}</span></span>
        <svg class="w-5 h-5 text-lightgray sort-chevron" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
        </svg>
    `;

        // Dropdown options (hidden initially)
        const dropdown = document.createElement("div");
        dropdown.className =
          "dropdown-menu absolute z-10 mt-1 hidden w-full bg-gray-800 rounded-lg shadow-lg py-1";

        const sortOptions = [
          { value: "popularity", label: "Popularity" },
          { value: "title", label: "Title" },
          { value: "author", label: "Author" },
          { value: "rating", label: "Rating" },
          { value: "publishDate", label: "Year" },
        ];

        sortOptions.forEach((option) => {
          const optionElement = document.createElement("button");
          // Add custom class for selected option to ensure theme compatibility
          optionElement.className = `w-full text-left px-4 py-2 hover:bg-gray-700 ${
            appState.sortOption === option.value
              ? "font-medium selected-option"
              : ""
          }`;

          // Additional class for selected option background
          if (appState.sortOption === option.value) {
            optionElement.classList.add("bg-gray-700");
          }

          optionElement.textContent = option.label;
          optionElement.dataset.value = option.value;

          optionElement.addEventListener("click", () => {
            appState.sortOption = option.value;

            // Update dropdown button text
            sortDisplay.querySelector("span .font-medium").textContent =
              getSortOptionLabel(option.value);

            // Update active state of options
            dropdown.querySelectorAll("button").forEach((btn) => {
              btn.classList.remove(
                "font-medium",
                "bg-gray-700",
                "selected-option"
              );
              if (btn.dataset.value === option.value) {
                btn.classList.add(
                  "font-medium",
                  "bg-gray-700",
                  "selected-option"
                );
              }
            });

            // Update the current page
            if (appState.currentPage === "explore") {
              appState.filteredBooks = sortBooks(
                appState.filteredBooks,
                appState.sortOption,
                appState.sortDirection
              );
              showExplorePage();
            } else if (appState.currentPage === "favorites") {
              showFavoritesPage();
            }

            // Close dropdown with animation
            dropdown.classList.remove("show");
            setTimeout(() => {
              dropdown.classList.add("hidden");
              sortDisplay.setAttribute("aria-expanded", "false");
            }, 300);
          });

          dropdown.appendChild(optionElement);
        });

        // Toggle dropdown visibility with animation
        sortDisplay.addEventListener("click", () => {
          const isExpanded =
            sortDisplay.getAttribute("aria-expanded") === "true";
          sortDisplay.setAttribute("aria-expanded", !isExpanded);

          if (isExpanded) {
            dropdown.classList.remove("show");
            setTimeout(() => {
              dropdown.classList.add("hidden");
            }, 300); // Match transition duration
          } else {
            dropdown.classList.remove("hidden");
            // Force reflow to ensure transition works
            dropdown.offsetHeight;
            dropdown.classList.add("show");
          }
        });

        // Close dropdown when clicking outside
        document.addEventListener("click", (e) => {
          if (!sortControls.contains(e.target)) {
            dropdown.classList.remove("show");
            setTimeout(() => {
              dropdown.classList.add("hidden");
              sortDisplay.setAttribute("aria-expanded", "false");
            }, 300);
          }
        });

        // Sort direction button
        const sortDirectionButton = document.createElement("button");
        sortDirectionButton.className = `sort-direction-button ml-2 p-3 rounded-lg bg-gray-800 text-lightgray hover:bg-gray-700 ${
          appState.sortDirection === "asc" ? "asc" : "desc"
        }`;
        sortDirectionButton.innerHTML = `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 3a1 1 0 000 2h11a1 1 0 100-2H3zM3 7a1 1 0 000 2h7a1 1 0 100-2H3zM3 11a1 1 0 100 2h4a1 1 0 100-2H3zM15 8a1 1 0 10-2 0v5.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L15 13.586V8z"></path></svg>`;

        // Add event listeners for sort direction
        sortDirectionButton.addEventListener("click", () => {
          appState.sortDirection =
            appState.sortDirection === "asc" ? "desc" : "asc";

          // Toggle the class for animation
          sortDirectionButton.classList.toggle("asc");

          // Update the current page
          if (appState.currentPage === "explore") {
            appState.filteredBooks = sortBooks(
              appState.filteredBooks,
              appState.sortOption,
              appState.sortDirection
            );
            showExplorePage();
          } else if (appState.currentPage === "favorites") {
            showFavoritesPage();
          }
        });

        // Assemble sort controls
        const sortControlsWrapper = document.createElement("div");
        sortControlsWrapper.className =
          "flex items-center sort-controls-wrapper";

        sortControls.appendChild(sortDisplay);
        sortControls.appendChild(dropdown);

        sortControlsWrapper.appendChild(sortControls);
        sortControlsWrapper.appendChild(sortDirectionButton);

        return sortControlsWrapper;
      }

      // Get label for sort option
      function getSortOptionLabel(value) {
        const options = {
          title: "Title",
          author: "Author",
          rating: "Rating",
          publishDate: "Year",
          popularity: "Popularity",
        };

        return options[value] || "Rating";
      }

      // Show the categories page
      function showCategoriesPage() {
        appState.currentPage = "categories";
        updateActiveNavTab();

        // Clear main container
        mainContainer.innerHTML = "";
        mainContainer.className = "container mx-auto px-4 pt-6 pb-24";

        // Prepare app structure
        if (!appContainer.contains(headerContainer)) {
          appContainer.appendChild(headerContainer);
        }

        if (!appContainer.contains(mainContainer)) {
          appContainer.appendChild(mainContainer);
        }

        // Create categories header
        const categoriesHeader = document.createElement("div");
        categoriesHeader.className = "mb-6";

        const categoriesTitle = document.createElement("h2");
        categoriesTitle.className = "text-2xl md:text-3xl font-bold mb-2";
        categoriesTitle.textContent = "Categories";

        const categoriesDescription = document.createElement("p");
        categoriesDescription.className = "text-lightgray";
        categoriesDescription.textContent = "Browse books by genre";

        categoriesHeader.appendChild(categoriesTitle);
        categoriesHeader.appendChild(categoriesDescription);

        // Create categories list - now full-width cards instead of grid
        const categoriesList = document.createElement("div");
        categoriesList.className = "space-y-4"; // Vertical spacing between cards

        // Get unique genres and sort them alphabetically
        const genres = [
          ...new Set(appState.books.map((book) => book.genre)),
        ].sort();

        // Create category tiles
        genres.forEach((genre) => {
          const genreCard = createCategoryCard(genre);
          categoriesList.appendChild(genreCard);
        });

        // Assemble categories page
        mainContainer.appendChild(categoriesHeader);
        mainContainer.appendChild(categoriesList);
      }

      // Create a category card
      function createCategoryCard(genre) {
        const count = appState.books.filter(
          (book) => book.genre === genre
        ).length;

        const card = document.createElement("div");
        card.className =
          "category-card relative rounded-xl overflow-hidden cursor-pointer transform transition-all duration-300 hover:-translate-y-1 hover:shadow-xl";
        card.style.height = "160px";

        // Always use image background for better visual appeal
        const imageUrl =
          genreImages[genre] ||
          "https://images.unsplash.com/photo-1512820790803-83ca734da794?q=80&w=800";

        // Background image
        const categoryImage = document.createElement("img");
        categoryImage.className = "w-full h-full object-cover";
        categoryImage.src = imageUrl;
        categoryImage.alt = genre;

        // Overlay for better text visibility with gradient
        const overlay = document.createElement("div");
        overlay.className =
          "absolute inset-0 bg-gradient-to-r from-black/80 to-transparent";

        // 3D effect with shadow and perspective
        const perspectiveContainer = document.createElement("div");
        perspectiveContainer.className =
          "absolute inset-0 transform perspective shadow-md hover:shadow-xl transition-all duration-300";

        // Content
        const content = document.createElement("div");
        content.className = "absolute inset-0 p-6 flex flex-col justify-center";

        const genreName = document.createElement("h3");
        genreName.className = "text-2xl font-bold mb-2 text-white";
        genreName.textContent = genre;

        const bookCount = document.createElement("p");
        bookCount.className = "text-sm text-white/80";
        bookCount.textContent = `${count} book${count !== 1 ? "s" : ""}`;

        content.appendChild(genreName);
        content.appendChild(bookCount);

        // Assemble card with the new 3D effect
        card.appendChild(categoryImage);
        card.appendChild(overlay);
        card.appendChild(perspectiveContainer);
        card.appendChild(content);

        // Add click event to navigate to explore with genre filter
        card.addEventListener("click", () => {
          // Set the selected genre in appState
          appState.selectedGenre = genre;

          // Filter books for this genre
          appState.filteredBooks = appState.books.filter(
            (book) => book.genre === genre
          );

          // Store the genre filter in sessionStorage to persist during navigation
          sessionStorage.setItem("selectedGenre", genre);

          // Navigate to explore page
          window.location.hash = "explore";
        });

        return card;
      }

      // Show the favorites page
      function showFavoritesPage() {
        appState.currentPage = "favorites";
        updateActiveNavTab();

        // Clear main container
        mainContainer.innerHTML = "";
        mainContainer.className = "container mx-auto px-4 pt-6 pb-24";

        // Prepare app structure
        if (!appContainer.contains(headerContainer)) {
          appContainer.appendChild(headerContainer);
        }

        if (!appContainer.contains(mainContainer)) {
          appContainer.appendChild(mainContainer);
        }

        // Create favorites header
        const favoritesHeader = document.createElement("div");
        favoritesHeader.className = "mb-6";

        const favoritesTitle = document.createElement("h2");
        favoritesTitle.className = "text-2xl md:text-3xl font-bold mb-2";
        favoritesTitle.textContent = "Favorite Books";

        const favoritesDescription = document.createElement("p");
        favoritesDescription.className = "text-lightgray";
        favoritesDescription.textContent = "Your collection of loved books";

        favoritesHeader.appendChild(favoritesTitle);
        favoritesHeader.appendChild(favoritesDescription);
        mainContainer.appendChild(favoritesHeader);

        // Create controls section
        const controlsSection = document.createElement("div");
        controlsSection.className =
          "mb-6 flex flex-wrap justify-between items-center gap-4 controls-container";

        // Create view toggle
        const viewToggle = document.createElement("div");
        viewToggle.className =
          "view-toggle flex bg-gray-800 rounded-lg overflow-hidden p-1";

        const gridButton = document.createElement("button");
        gridButton.className = `p-2 ${
          appState.viewMode === "grid"
            ? "bg-gray-700 text-white"
            : "text-lightgray hover:text-white"
        } rounded-md`;
        gridButton.innerHTML = `
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
        </svg>
    `;

        const listButton = document.createElement("button");
        listButton.className = `p-2 ${
          appState.viewMode === "list"
            ? "bg-gray-700 text-white"
            : "text-lightgray hover:text-white"
        } rounded-md`;
        listButton.innerHTML = `
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
        </svg>
    `;

        // Add event listeners for view toggle
        gridButton.addEventListener("click", () => {
          if (appState.viewMode !== "grid") {
            appState.viewMode = "grid";
            showFavoritesPage();
          }
        });

        listButton.addEventListener("click", () => {
          if (appState.viewMode !== "list") {
            appState.viewMode = "list";
            showFavoritesPage();
          }
        });

        viewToggle.appendChild(gridButton);
        viewToggle.appendChild(listButton);

        // Create sort controls
        const sortControls = createSortControls();

        // Assemble controls
        controlsSection.appendChild(viewToggle);
        controlsSection.appendChild(sortControls);
        mainContainer.appendChild(controlsSection);

        // Get favorite books from localStorage
        const favoriteBooks = JSON.parse(
          localStorage.getItem("favoriteBooks") || "[]"
        );

        // Show empty state if no favorites
        if (favoriteBooks.length === 0) {
          const emptyState = document.createElement("div");
          emptyState.className = "text-center py-16";
          emptyState.innerHTML = `
            <div class="text-6xl mb-4 opacity-50">💔</div>
            <h3 class="text-xl font-bold mb-2">No favorite books yet</h3>
            <p class="text-lightgray mb-4">Start adding books you love to your favorites</p>
            <a href="#explore" class="inline-block px-4 py-2 primary-gradient rounded-lg">Explore Books</a>
        `;
          mainContainer.appendChild(emptyState);
          return;
        }

        // Sort favorites
        const sortedFavorites = sortBooks(
          favoriteBooks,
          appState.sortOption,
          appState.sortDirection
        );

        // Create book grid with the selected view mode
        const bookContainer = BookGrid(sortedFavorites, appState.viewMode);
        mainContainer.appendChild(bookContainer);
      }

      // Sort books based on the selected option and direction
      function sortBooks(books, option, direction) {
        return [...books].sort((a, b) => {
          let comparison = 0;

          switch (option) {
            case "title":
              comparison = a.title.localeCompare(b.title);
              break;
            case "author":
              comparison = a.author.localeCompare(b.author);
              break;
            case "rating":
              comparison = b.rating - a.rating; // Higher ratings first
              break;
            case "popularity":
              comparison = b.popularity - a.popularity; // Higher popularity first
              break;
            case "publishDate":
              const dateA = new Date(a.publishDate);
              const dateB = new Date(b.publishDate);
              comparison = dateB - dateA; // Newer books first
              break;
            default:
              comparison = 0;
          }

          // Reverse for ascending order
          return direction === "asc" ? comparison * -1 : comparison;
        });
      }

      // Event listeners setup
      function setupEventListeners() {
        // Check saved theme preference
        if (localStorage.getItem("darkMode") === "false") {
          document.body.classList.add("light-mode");

          // Update theme toggle icon if it exists
          const themeToggle = document.getElementById("desktopDarkModeToggle");
          if (themeToggle) {
            themeToggle.innerHTML = `<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
            </svg>`;
          }
        }

        // Setup custom cursor for search inputs
        setupCustomCursor();
      }

      // Custom cursor for search input
      function setupCustomCursor() {
        // Disable custom cursor functionality completely
        return;

        /*
    // Original code disabled
    const searchInputs = document.querySelectorAll('input[type="text"]');
    
    searchInputs.forEach(input => {
        // Create cursor element
        const cursor = document.createElement('span');
        cursor.className = 'custom-cursor';
        
        // Set initial position
        cursor.style.left = input.offsetLeft + 'px';
        cursor.style.top = input.offsetTop + 'px';
        
        // Add to document
        document.body.appendChild(cursor);
        
        // Update cursor position on input
        input.addEventListener('input', () => {
            updateCustomCursor(input);
        });
        
        // Update cursor position on focus
        input.addEventListener('focus', () => {
            cursor.style.display = 'block';
            updateCustomCursor(input);
        });
        
        // Hide cursor on blur
        input.addEventListener('blur', () => {
            cursor.style.display = 'none';
        });
    });
    */
      }

      // Update custom cursor position
      function updateCustomCursor(input) {
        // Disabled - no custom cursor functionality
        return;

        /*
    // Original code disabled
    const cursor = document.querySelector('.custom-cursor');
    if (!cursor) return;
    
    // Create a temp element to measure text width
    const temp = document.createElement('span');
    temp.style.visibility = 'hidden';
    temp.style.position = 'absolute';
    temp.style.whiteSpace = 'pre';
    temp.style.font = window.getComputedStyle(input).font;
    temp.textContent = input.value.substring(0, input.selectionStart);
    document.body.appendChild(temp);
    
    // Calculate cursor position
    const inputRect = input.getBoundingClientRect();
    const cursorX = inputRect.left + temp.offsetWidth + 4; // Add padding
    const cursorY = inputRect.top + (inputRect.height / 2) - (cursor.offsetHeight / 2);
    
    // Update cursor position
    cursor.style.left = cursorX + 'px';
    cursor.style.top = cursorY + 'px';
    
    // Remove temp element
    document.body.removeChild(temp);
    */
      }

      // Get unique genres from books
      function getUniqueGenres(books) {
        return [...new Set(books.map((book) => book.genre))].sort();
      }

      // Get unique years from books
      function getUniqueYears(books) {
        return [
          ...new Set(
            books.map((book) => new Date(book.publishDate).getFullYear())
          ),
        ]
          .sort()
          .reverse();
      }

      // Show the loader
      function showLoader() {
        const loader = document.getElementById("preloader");
        if (loader) {
          loader.style.display = "flex";
        }
      }

      // Hide the loader
      function hideLoader() {
        const loader = document.getElementById("preloader");
        if (loader) {
          loader.style.display = "none";
        }

        // Add main container to app if not already added
        if (!appContainer.contains(mainContainer)) {
          appContainer.appendChild(mainContainer);
        }
      }

      // Show an error message
      function showError(message) {
        const errorElement = document.createElement("div");
        errorElement.className =
          "error-message fixed top-4 right-4 bg-red-500 text-white p-4 rounded-lg shadow-lg z-50";
        errorElement.textContent = message;

        document.body.appendChild(errorElement);

        // Remove after 5 seconds
        setTimeout(() => {
          errorElement.remove();
        }, 5000);
      }

      // Show book details in a modal
      function showBookDetails(book) {
        // Prevent modal from opening automatically on page load
        if (!allowModalOpen) {
          console.log("Modal opening prevented during page load");
          return;
        }

        const modal = document.getElementById("bookDetailsModal");
        const modalContent = document.getElementById("bookDetailsContent");

        if (!modal || !modalContent) {
          console.error("Modal elements not found");
          return;
        }

        // Check if the book is in favorites
        const favoriteBooks = JSON.parse(
          localStorage.getItem("favoriteBooks") || "[]"
        );
        const isLiked = favoriteBooks.some((favBook) => favBook.id === book.id);

        // Format publish date
        const publishDate = new Date(book.publishDate);
        const formattedDate = publishDate.toLocaleDateString("en-US", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });

        // Populate modal content
        modalContent.innerHTML = `
        <div class="relative flex flex-col md:flex-row gap-6">
            <!-- Cover Image -->
            <div class="flex-shrink-0 w-full md:w-1/3 mx-auto md:mx-0 max-w-xs">
                <div class="aspect-[2/3] rounded-xl overflow-hidden shadow-lg">
                    <img 
                        src="${book.coverUrl}" 
                        alt="${book.title}" 
                        class="w-full h-full object-cover"
                        onerror="this.src='https://images.unsplash.com/photo-1543002588-bfa74002ed7e?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8Ym9va3xlbnwwfHwwfHx8MA%3D%3D'"
                    >
                </div>
            </div>
            
            <!-- Book Information -->
            <div class="flex-1">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-2xl md:text-3xl font-bold mb-2">${
                          book.title
                        }</h2>
                        <p class="text-xl text-lightgray mb-4">by ${
                          book.author
                        }</p>
                    </div>
                    <button id="modalFavoriteBtn" class="p-2 rounded-full bg-gray-800 hover:bg-gray-700 ${
                      isLiked ? "text-pink-500" : "text-white"
                    }">
                        <svg class="w-6 h-6" fill="${
                          isLiked ? "currentColor" : "none"
                        }" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="mb-4 flex items-center">
                    <div class="mr-2 flex">
                        ${generateStarsHTML(book.rating)}
                    </div>
                    <span class="text-sm text-lightgray">(${book.rating.toFixed(
                      1
                    )})</span>
                </div>
                
                <div class="flex flex-wrap gap-2 mb-4">
                    <span class="px-3 py-1 rounded-full ${getGenreClass(
                      book.genre
                    )} text-white text-sm">${book.genre}</span>
                    <span class="px-3 py-1 rounded-full bg-gray-800 text-sm">${formattedDate}</span>
                    <span class="px-3 py-1 rounded-full bg-gray-800 text-sm">${
                      book.pages
                    } pages</span>
                    <span class="px-3 py-1 rounded-full bg-gray-800 text-sm">${
                      book.popularity
                    }% Popular</span>
                </div>
                
                <div class="mb-4">
                    <h3 class="text-lg font-semibold mb-2">Description</h3>
                    <p class="text-lightgray">${
                      book.description || "No description available."
                    }</p>
                </div>
                
                ${
                  book.quotes && book.quotes.length > 0
                    ? `
                <div>
                    <h3 class="text-lg font-semibold mb-2">Notable Quote</h3>
                    <blockquote class="border-l-4 border-gray-600 pl-4 italic text-lightgray">
                        "${book.quotes[0]}"
                    </blockquote>
                </div>
                `
                    : ""
                }
            </div>
        </div>
    `;

        // Apply mobile-specific styles for drawer effect if on mobile
        if (appState.isMobile) {
          const modalContentElement = modal.querySelector(".modal-content");
          if (modalContentElement) {
            modalContentElement.classList.add("drawer");
          }
        }

        // Show the modal - set both class and style
        modal.classList.remove("hidden");
        modal.style.display = "flex";

        // Setup modal closing functionality
        setupModalClose(modal);

        // Setup favorite button functionality
        setupFavoriteButton(book);

        // Add swipe functionality for mobile
        if (appState.isMobile) {
          setupSwipeToClose(modal);
        }
      }

      // Setup modal close functionality
      function setupModalClose(modal) {
        const closeBtn = document.getElementById("closeModalBtn");

        if (closeBtn) {
          // Ensure we don't attach multiple event listeners
          const newCloseBtn = closeBtn.cloneNode(true);
          closeBtn.parentNode.replaceChild(newCloseBtn, closeBtn);

          newCloseBtn.addEventListener("click", () => {
            hideModal(modal);
          });
        }

        // Close when clicking outside content area
        modal.addEventListener("click", (e) => {
          if (e.target === modal) {
            hideModal(modal);
          }
        });

        // Add keyboard support (Escape key)
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && !modal.classList.contains("hidden")) {
            hideModal(modal);
          }
        });
      }

      // Helper function to hide modal
      function hideModal(modal) {
        modal.classList.add("hidden");
        modal.style.display = "none";
      }

      // Setup swipe to close for mobile
      function setupSwipeToClose(modal) {
        const modalContent = modal.querySelector(".modal-content");
        let startY = 0;
        let currentY = 0;

        // Track touch start position
        modalContent.addEventListener("touchstart", (e) => {
          startY = e.touches[0].clientY;
        });

        // Track touch movement
        modalContent.addEventListener("touchmove", (e) => {
          // Only allow swiping down
          currentY = e.touches[0].clientY;
          const deltaY = currentY - startY;

          // Only allow downward swipe
          if (deltaY > 0) {
            // Apply transform to follow finger (with resistance)
            const resistance = 0.3;
            modalContent.style.transform = `translateY(${
              deltaY * resistance
            }px)`;
            e.preventDefault(); // Prevent page scrolling
          }
        });

        // Handle touch end
        modalContent.addEventListener("touchend", () => {
          const deltaY = currentY - startY;

          // If swiped down far enough, close the modal
          if (deltaY > 100) {
            modal.classList.add("hidden");
            // Reset position with transition
            modalContent.style.transition = "transform 0.3s ease-out";
            modalContent.style.transform = "translateY(100%)";

            // Reset transition after animation completes
            setTimeout(() => {
              modalContent.style.transition = "";
              modalContent.style.transform = "";
            }, 300);
          } else {
            // Reset position with animation
            modalContent.style.transition = "transform 0.2s ease-out";
            modalContent.style.transform = "";

            // Reset transition after animation completes
            setTimeout(() => {
              modalContent.style.transition = "";
            }, 200);
          }
        });
      }

      // Setup modal favorite button
      function setupFavoriteButton(book) {
        const favoriteBtn = document.getElementById("modalFavoriteBtn");

        if (favoriteBtn) {
          // Remove any existing event listeners
          const newFavoriteBtn = favoriteBtn.cloneNode(true);
          favoriteBtn.parentNode.replaceChild(newFavoriteBtn, favoriteBtn);

          newFavoriteBtn.addEventListener("click", () => {
            toggleFavorite(book);

            // Update UI
            const updatedFavorites = JSON.parse(
              localStorage.getItem("favoriteBooks") || "[]"
            );
            const isLiked = updatedFavorites.some(
              (favBook) => favBook.id === book.id
            );

            newFavoriteBtn.className = `p-2 rounded-full bg-gray-800 hover:bg-gray-700 ${
              isLiked ? "text-pink-500" : "text-white"
            }`;
            newFavoriteBtn
              .querySelector("svg")
              .setAttribute("fill", isLiked ? "currentColor" : "none");
          });
        }
      }

      // Toggle a book as favorite
      function toggleFavorite(book) {
        const favorites = JSON.parse(
          localStorage.getItem("favoriteBooks") || "[]"
        );
        const isLiked = favorites.some((favBook) => favBook.id === book.id);

        if (isLiked) {
          // Remove from favorites
          const updatedFavorites = favorites.filter(
            (favBook) => favBook.id !== book.id
          );
          localStorage.setItem(
            "favoriteBooks",
            JSON.stringify(updatedFavorites)
          );
        } else {
          // Add to favorites
          favorites.push(book);
          localStorage.setItem("favoriteBooks", JSON.stringify(favorites));
        }

        // Update UI if on favorites page
        if (appState.currentPage === "favorites") {
          showFavoritesPage();
        }
      }

      // Initialize the app when the DOM is loaded
      document.addEventListener("DOMContentLoaded", initApp);

      // Create a function to add CSS animation classes to BookGrid
      function BookGrid(books, viewMode = "grid") {
        const container = document.createElement("div");
        container.className = "book-grid-container";

        if (books.length === 0) {
          // Show empty state
          container.className = "empty-state text-center py-16";
          container.innerHTML = `
            <div class="text-6xl mb-4 opacity-50">📚</div>
            <h3 class="text-xl font-bold mb-2">No books found</h3>
            <p class="text-lightgray">Try adjusting your filters or search terms</p>
        `;
          return container;
        }

        // Set container class based on view mode
        if (viewMode === "grid") {
          container.className =
            "book-grid-container grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4";

          // Create and append book cards with staggered animation
          books.forEach((book, index) => {
            const card = BookCard(book);
            // Add staggered animation delay
            card.style.animationDelay = `${index * 0.05}s`;
            container.appendChild(card);
          });
        } else {
          container.className = "book-grid-container flex flex-col gap-4";

          // Create and append book list items with staggered animation
          books.forEach((book, index) => {
            const listItem = BookListItem(book);
            // Add staggered animation delay
            listItem.style.animationDelay = `${index * 0.05}s`;
            container.appendChild(listItem);
          });
        }

        return container;
      }
    </script>

    <!-- Hide preloader after page loads -->
    <script>
      window.addEventListener("load", function () {
        setTimeout(function () {
          document.getElementById("preloader").classList.add("hidden");

          // Ensure book details modal is hidden on page load
          const modal = document.getElementById("bookDetailsModal");
          if (modal) {
            modal.classList.add("hidden");
            modal.style.display = "none";
          }
        }, 800);
      });
    </script>

    <script>
      // Check for theme preference immediately on page load
      document.addEventListener("DOMContentLoaded", function () {
        if (localStorage.getItem("darkMode") === "false") {
          document.body.classList.add("light-mode");
        }

        // Ensure book details modal is hidden when DOM is loaded
        const modal = document.getElementById("bookDetailsModal");
        if (modal) {
          modal.classList.add("hidden");
          modal.style.display = "none";
        }
      });
    </script>
  </body>
</html>
